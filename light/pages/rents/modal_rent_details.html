<!-- style -->
<style>

    .default_dropdown_source {
        padding-bottom: 10px !important;
        margin-bottom: 5px;
        border-bottom: 1px solid rgba(206, 212, 218, 1);
        border-radius: 0 !important;
    }

    #rent_details_modal .ui-datepicker-group.ui-datepicker-group-last table {
        border-left: 2px solid #ced4da33;
    }

    .notification_msg {
        position: absolute;
        top: 5px;
        right: 10px;
        width: 1.2rem;
        height: 1.2rem;
        font-size: 0.7rem;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        font-weight: 500;
        background-color: #e63946;
        line-height: normal;
        color: white;
    }
</style>

<!-- page -->
<div id="rent_details_modal" class="view_modal">

    <div class="modal_backdrop"></div>

    <div class="modal_dialog modal_lg">

        <div class="modal_content position-relative">

            <!--loading -->
            <div id="modal_rent_details_content_loading" class="view_loading" style="display: none;">
                <img src="/assets/images/icons/loading.svg" />
            </div>

            <!-- header -->
            <div class="modal_header">
                <ul class="modal_ul nav nav-tabs">
                    <li>
                        <a data-toggle="tab" href="#modal_body_details" class="active" title='Reservation'><i class="fas fa-concierge-bell" onclick="modal_details_rent.bl.load_data(modal_details_rent.rent_id)"></i></a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#modal_body_price_per_day" onclick="modal_details_rent.bl.extra_charges_clear();" title='Charges'><i class="fas fa-tag"></i></a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#modal_body_guests_list" onclick="modal_details_rent.ui.load_invoices_list(); modal_details_rent.ui.load_guests();" id="modal_body_guests_list_tab" title='Guests'><i class="fas fa-users"></i></a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#modal_body_payments" onclick="modal_details_rent.bl.load_payments();" title='Payments'><i class="fas fa-cash-register"></i></a>
                    </li>
                    <li class="hidden">
                        <a data-toggle="tab" href="#modal_body_edit_guest" id="modal_body_edit_guest_tab"><i class="fas fa-user-edit"></i></a>
                    </li>
                    <li class="hidden">
                        <a data-toggle="tab" href="#modal_body_add_guest" id="modal_body_add_guest_tab"><i class="fas fa-user-plus"></i></a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#modal_body_bills" onclick="modal_details_rent.ui.load_invoices_list();" id="modal_rent_details_bills"><i class="fas fa-file-alt"></i></a>
                    </li>
                    <li class="hidden">
                        <a data-toggle="tab" href="#modal_body_credit_card"><i class="far fa-credit-card"></i></a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#modal_body_messages" onclick="modal_details_rent.ui.load_emails();" title='E-mails'><i class="far fa-envelope"></i></a>
                    </li>

                    <li class="hidden">
                        <a data-toggle="tab" href="#modal_body_option"><i class="far fa-calendar-plus"></i></a>
                    </li>
                    <li class="hidden">
                        <a data-toggle="tab" href="#modal_body_add_payment"><i class="fas fa-money-bill-alt" onclick="modal_details_rent.ui.load_payment_recive();"></i></a>
                    </li>
                    <li class="hidden">
                        <a data-toggle="tab" href="#modal_body_add_key"><i class="fas fa-key"></i></a>
                    </li>
                    <li>
                        <a id="modal_details_rent_chat_tab_href" data-toggle="tab" href="#modal_body_chat" onclick="modal_details_rent.ui.load_messages();"><i class="far fa-comments"></i></a>
                        <div id="modal_new_messages" class="notification_msg hidden"></div>
                    </li>

                </ul>
                <div class="close" data-dismiss="modal" id="modal_rent_details_close_modal"><i class="fas fa-times"></i></div>
            </div>

            <!-- body-->
            <div class="modal_wrapper bg-white">

                <div class="tab-content ">

                    <!-- rent details -->
                    <div id="modal_body_details" class="tab-pane active">

                        <div class="modal-body">

                            <!-- Info -->
                            <div class="row">

                                <!------------- 1. Row ------------->
                                <!-- 1. Column -->
                                <div class="col-lg-4 pb-2">
                                    <div class="row">
                                        <div class="col-lg-12 col-md-6">

                                            <!-- Icon -->
                                            <div id="modal_rent_details_icon_portal_dropdown" class="view_dropdown dropdown w-100 h-auto mb-2">
                                                <button type="button" class="btn btn_hover px-2 py-1 w-100">
                                                    <div class="d-flex align-items-center">
                                                        <div class="modal_icon">
                                                            <img src="./assets/images/icons/portals/circle.svg" alt="icon portal" id="modal_rent_details_image">
                                                        </div>
                                                        <div class="w-100">
                                                            <div class="d-flex justify-content-between align-items-center">
                                                                <div class="modal_rent_id text-left font_4 font_bold" id="modal_rent_details_portal">&nbsp;</div>
                                                                <div class="pl-2 ml-auto font_1 p-1">
                                                                    <i class="fas fa-chevron-down"></i>
                                                                </div>
                                                            </div>
                                                            <div class="d-flex justify-content-between">
                                                                <div id="modal_rent_details_rent_id">&nbsp;</div>
                                                                <div class="btn btn_hover p-1 d-flex" data-toggle="tooltip" data-placement="top" data-original-title="Copy ID" onclick="modal_details_rent.bl.copy_to_clipboard(event, this)"><i class="far fa-copy"></i><!--<i class="far fa-copy fa-xs"></i>--></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                                <div id="modal_rent_sources_dropdown" class="dropdown_menu w-100 hidden">
                                                    <!--<div class="d-flex justify-content-between pt-3 px-3 pb-2">
                                                        <div class="font_bold">Status</div>
                                                        <div class="dropdown_close"><i class="fas fa-times"></i></div>
                                                    </div>
                                                    <hr class="m-0">-->
                                                    <ul id="modal_rent_details_rent_source_dropdown" class="dropdown_ul dropdown_icon ul_icon_white font_3" style="max-height: 15rem; overflow-y: auto;">

                                                        <li class="dropdown_li default_dropdown_source" data-id="" data-name="">
                                                            <div class="d-flex align-items-center">
                                                                <div class="icon icon_img">
                                                                    <img src="./assets/images/icons/portals/syncbeds.svg" alt="">
                                                                </div>
                                                                <div class="name align-self-center">Syncbeds</div>
                                                            </div>
                                                        </li>

                                                        <!-- Others inserted dynamically -->
                                                    </ul>
                                                </div>
                                            </div>


                                        </div>
                                        <div class="col-lg-12 col-md-6">


                                            <div id="modal_rent_details_cancelation_policy" class="view_dropdown dropdown">
                                                <button type="button" class="btn btn_hover px-2 py-1 w-100">
                                                    <div class="d-flex align-items-center w-100">
                                                        <span class="mr-3 font_8 d-flex py-2">
                                                            <i class="far fa-calendar-check"></i>
                                                        </span>
                                                        <div class="dropdown_label mr-1">
                                                            <div class="font_1 text-uppercase font_bold text-left pb-1">
                                                                Cancellation policy
                                                            </div>
                                                            <div class="font_3 dropdown_name text-left">
                                                                <div class="d-flex align-items-center">
                                                                    <!--<div class="icon"><i class="fas fa-piggy-bank"></i></div>-->
                                                                    <div class="name align-self-center">Cash</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="btn_toogleArrow pl-2 ml-auto font_1">
                                                            <i class="fas fa-chevron-down"></i>
                                                        </div>
                                                    </div>
                                                </button>

                                                <div class="dropdown_menu w-100 hidden">
                                                    <ul class="dropdown_ul dropdown_icon ul_icon_white font_3" style="max-height: 15rem; overflow-y: auto;">
                                                        <li class="dropdown_li" data-id="1">Custom</li>
                                                        <li class="dropdown_li" data-id="2">No refund</li>
                                                        <li class="dropdown_li" data-id="3">Firm</li>
                                                        <li class="dropdown_li" data-id="4">Moderate</li>
                                                        <li class="dropdown_li" data-id="5">Relaxed</li>
                                                        <li class="dropdown_li" data-id="6">Full refund</li>
                                                    </ul>
                                                </div>

                                            </div>


                                            <!-- Calendar -->
                                            <!--<div class="modal_period btn_hover position-relative d-flex align-items-center justify-content-between" ;>
                                                <div class="d-flex align-items-center">
                                                    <div class="pr-2">
                                                        <i class="far fa-calendar-alt pr-2"></i>
                                                    </div>
                                                    <div>
                                                        <div id="modal_rent_details_rent_date_from">03.11.20</div>
                                                        <div id="modal_rent_details_rent_date_until">09.11.20</div>
                                                    </div>
                                                </div>
                                                <div class="modal_dropdown_menu_calendar">
                                                    <div id="modal_details_calendar"></div>
                                                </div>
                                                <div class="font_1"><i class="fas fa-chevron-down"></i></div>
                                            </div>-->

                                        </div>
                                    </div>

                                    <!-- Advance & Total -->
                                    <!--<div class="d-flex pl-2 pb-2 pt-1 justify-content-between">
                                        <div class="text-center w-50">
                                            <div class="modal_label text-left">
                                                <div class="font_bold font_3">Advance</div>
                                                <div class="d-flex">
                                                    <div id="modal_rent_details_in_advance_1"></div>
                                                    <div class="pl-2" id="modal_rent_detail_in_advance_1_currency">€</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal_line_y"></div>
                                        <div class="text-center w-50">
                                            <div class="modal_label text-left">
                                                <div class="font_bold font_3">Total</div>
                                                <div class="d-flex">
                                                    <div id="modal_rent_details_price"></div>
                                                    <div class="pl-2" id="modal_rent_details_price_currency">€</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>-->

                                </div>

                                <!-- 2. Column -->
                                <!-- Guest -->
                                <div class="col-lg-4 mb-3 border-left border-right">
                                    <div class="guest">
                                        <div class="guest_p d-flex align-items-center mb-2 position-relative">
                                            <span class="position-absolute left_0 position_Y_center"><i class="fas fa-user px-2"></i></span>
                                            <input type="text" class="inside_input font_bold input_hover_text pl-5" value="Janmik Wilder" placeholder="Guest name" id="modal_rent_details_contact_name">
                                        </div>
                                        <div class="guest_p d-flex align-items-center mb-2 position-relative">
                                            <span class="position-absolute left_0 position_Y_center">
                                                <i class="fas fa-phone px-2"></i>
                                            </span>
                                            <input type="number" class="inside_input input_hover_text pl-5" value="+385 0004545" placeholder="Phone number" id="modal_rent_details_contact_tel">
                                        </div>
                                        <div class="guest_p d-flex align-items-center mb-2 position-relative">
                                            <span class="position-absolute left_0 position_Y_center">
                                                <i class="fas fa-envelope px-2"></i>
                                            </span>
                                            <input type="email" class="inside_input input_hover_text pl-5" value="example@example.com" placeholder="Email" id="modal_rent_details_contact_email">
                                        </div>
                                        <div class="guest_p d-flex pb-1">

                                            <!-- Country -->
                                            <div id="modal_filter_country" class="view_dropdown dropdown dropdown_sm w-100" data-id="" data-name="">
                                                <button class="btn btn_hover pl-2 pr-2 py-1 w-100">
                                                    <div class="d-flex align-items-center w-100">
                                                        <span class="mr-2 font_4 d-flex "><i class="fas fa-globe-europe"></i></span>
                                                        <div class="dropdown_label mr-1">
                                                            <div class="font_4 dropdown_name white">
                                                                <span class="flag pr-1">
                                                                    <img src="./assets/images/icons/flags/at.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Austria</span>
                                                            </div>
                                                        </div>
                                                        <div class="btn_toogleArrow pl-2 ml-auto font_1">
                                                            <i class="fas fa-chevron-down"></i>
                                                        </div>
                                                    </div>
                                                </button>
                                                <div class="dropdown_menu w-100 hidden">
                                                    <div class="dropdown_search px-3 py-2">
                                                        <input type="text" class="form-control" placeholder="Search">
                                                    </div>
                                                    <hr class="m-0">
                                                    <ul class="dropdown_ul ul_icon_white font_3" style="max-height: 15rem; overflow-y: auto;" id="modal_rent_details_countries_list">
                                                        <!--<li class="dropdown_li" data-country="1">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/at.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Austria</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="2">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/cz.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Czech Republic</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="3">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/fr.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>France</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="4">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/se.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Sweden</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="5">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/hr.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Croatia</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="6">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/de.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Germany</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="7">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/us.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>America</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="8">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/ro.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Romania</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="9">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/au.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Australia</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="10">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/ba.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Bosnia & Herzegovina</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="11">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/ar.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Argetina</span>
                                                            </div>
                                                        </li>
                                                        <li class="dropdown_li" data-country="11">
                                                            <div class="d-flex align-items-center">
                                                                <span class="flag pr-2">
                                                                    <img src="./assets/images/icons/flags/si.svg"
                                                                         alt="">
                                                                </span>
                                                                <span>Slovenia</span>
                                                            </div>
                                                        </li>-->
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <!-- 3. Column -->
                                <div class="col-lg-4 pb-2 cursor_point">

                                    <div class="btn btn_hover w-100" onclick="modal_details_rent.bl.click_to_price_per_day();">
                                        <!-- Advance -->
                                        <div class="d-flex justify-content-between line_normal">

                                            <div class="font_bold font_3 text-uppercase line_normal">Advance</div>
                                            <div id="modal_rent_details_in_advance_1" class="font_bold font_4 text-uppercase line_normal">&nbsp;<!--10000.00--></div>

                                        </div>
                                        <div class="d-flex justify-content-between pb-3">

                                            <div class="font_3 hidden text-uppercase opacity_50 line_normal">30.03.9999.</div>
                                            <div id="modal_rent_detail_in_advance_1_currency" class="font_2 text-uppercase opacity_50 line_normal">&nbsp;<!--EUR--></div>

                                        </div>

                                        <!-- Total -->
                                        <div class="d-flex justify-content-between line_normal">

                                            <div class="font_bold font_3 text-uppercase pr-2 line_normal">Total</div>
                                            <div id="modal_rent_details_price" class="font_bold font_4 text-uppercase line_normal">&nbsp;<!--10000.00--></div>

                                        </div>
                                        <div class="d-flex justify-content-between hidden pb-3">

                                            <div class="font_3 opacity_50 pr-2 line_normal">by 30.03.9999.</div>
                                            <div id="modal_rent_details_price_currency" class="font_2 text-uppercase opacity_50 line_normal">&nbsp;<!--EUR--></div>

                                        </div>

                                        <!-- Extra items -->
                                        <br />
                                        <div class="d-flex justify-content-between">

                                            <div class="font_bold font_1 text-uppercase pr-2">Extra items</div>
                                            <div class="font_bold font_1 text-uppercase">Per night</div>

                                        </div>
                                        <div class="d-flex justify-content-between line_normal">

                                            <div id="modal_price_extra_price" class="font_3 text-uppercase pr-2">&nbsp;<!--10000.00--></div>
                                            <div id="modal_rent_details_by_day" class="font_3 text-uppercase">&nbsp;<!--9999.99--></div>

                                        </div>
                                        <div class="d-flex justify-content-between line_normal">

                                            <div id="modal_price_extra_price_currency" class="font_2 text-uppercase opacity_50 pr-2">&nbsp;<!--EUR--></div>
                                            <div id="modal_rent_details_by_day_currency" class="font_2 text-uppercase opacity_50">&nbsp;<!--EUR--></div>

                                        </div>
                                    </div>

                                    <!--<div class="d-flex justify-content-between pb-0">
                                        <div class="small_title">Price</div>
                                        <div id="modal_rent_details_select_curr" class="select_curr">
                                            <button id="modal_rent_details_currency">EUR</button>
                                            <ul class="font_4 hidden" onclick="modal_details_rent.bl.load_data(modal_details_rent.rent_id)">
                                                <li>EUR</li>
                                                <li>HRK</li>
                                                <li>USD</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <hr class="my-2">
                                    <div class="d-flex justify-content-between border-bottom pb-2">
                                        <div class="w-50">Items</div>
                                        <div>100</div>
                                    </div>
                                    <div class="d-flex justify-content-between pb-2">
                                        <div class="space_nowrap pr-3">By person</div>
                                        <div class="position-relative">
                                            <input type="text" class="inside_input text-right" value="100" id="modal_rent_details_by_person">
                                        </div>

                                    </div>
                                    <div class="d-flex justify-content-between border-bottom pb-2">
                                        <div class="space_nowrap pr-2">By day</div>
                                        <div class="position-relative">
                                            <input type="text" class="inside_input text-right" value="100" id="modal_rent_details_by_day">
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between pb-2">
                                        <div class="pr-2">Exchange</div>
                                        <div>
                                            <input type="text" class="inside_input text-right" value="7.45" id="modal_rent_details_exchange">
                                        </div>
                                    </div>-->

                                </div>

                                <!------------- 2. Row ------------->
                                <div class="col-12 border-bottom border-top">
                                    <div class="row py-2">

                                        <!-- Dates -->
                                        <div class="col-md-6 border-right">
                                            <div id="modal_rent_details_calendar_dropdown" class="position-relative">
                                                <button id="modal_rent_details_calendar_btn" class="btn btn_hover px-2 py-1 w-100">
                                                    <div class="d-flex align-items-center w-100">
                                                        <div class="font_8 pr-2 d-flex"><i class="far fa-calendar-alt pr-2"></i></div>
                                                        <div>
                                                            <div class="font_bold font_1 text-uppercase text-left">Dates</div>
                                                            <div class="d-flex align-items-center">
                                                                <div id="modal_rent_details_calendar_check_in" data-day="">&nbsp;</div>
                                                                <i class="fas fa-chevron-right fa-xs mx-3 opacity_50"></i>
                                                                <div id="modal_rent_details_calendar_check_out" data-day="">&nbsp;</div>
                                                            </div>
                                                        </div>
                                                        <div class="pl-2 ml-auto font_1">
                                                            <i class="fas fa-chevron-down"></i>
                                                        </div>
                                                    </div>
                                                </button>

                                                <div id="modal_rent_details_calendar" class="modal_dropdown_menu_calendar hidden">
                                                </div>
                                            </div>

                                        </div>

                                        <!-- Guests -->
                                        <div class="col-md-6">

                                            <div id="modal_rent_details_guests" class="view_dropdown dropdown">

                                                <button class="btn btn_hover px-2 py-1 w-100">
                                                    <div class="d-flex align-items-center w-100">
                                                        <div class="font_8 pr-2 d-flex"><i class="fas fa-user-friends pr-2"></i></div>
                                                        <div>
                                                            <div class="font_bold font_1 text-uppercase text-left">Guests</div>
                                                            <div class="d-flex flex-wrap">
                                                                <div id="modal_rent_details_guests_adults"><span></span>&nbsp;Adults&nbsp;</div>
                                                                <div id="modal_rent_details_guests_children">|&nbsp;<span></span>&nbsp;Children&nbsp;</div>
                                                                <div id="modal_rent_details_guests_pets">|&nbsp;<span></span>&nbsp;Pets</div>
                                                            </div>
                                                        </div>
                                                        <div class="pl-2 ml-auto font_1">
                                                            <i class="fas fa-chevron-down"></i>
                                                        </div>
                                                    </div>
                                                </button>

                                                <div class="dropdown_menu w-100 p-3 hidden">

                                                    <!-- Adults -->
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <div>Adults</div>
                                                        <div id="modal_rent_details_adults" class="input-group input_group_md input_remove_number_arrow" style="width: 130px;">
                                                            <div class="input-group-prepend cursor_point">
                                                                <span class="input-group-text minus"><i class="fas fa-minus"></i></span>
                                                            </div>
                                                            <input type="number" class="form-control focus text-center" value="1">
                                                            <div class="input-group-append cursor_point">
                                                                <span class="input-group-text plus"><i class="fas fa-plus"></i></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Children -->
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <div>Children</div>
                                                        <div id="modal_rent_details_children" class="input-group input_group_md input_remove_number_arrow" style="width: 130px;">
                                                            <div class="input-group-prepend cursor_point">
                                                                <span class="input-group-text minus"><i class="fas fa-minus"></i></span>
                                                            </div>
                                                            <input type="number" class="form-control focus text-center" value="0">
                                                            <div class="input-group-append cursor_point">
                                                                <span class="input-group-text plus"><i class="fas fa-plus"></i></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Pets -->
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>Pets</div>
                                                        <div id="modal_rent_details_pets" class="input-group input_group_md input_remove_number_arrow" style="width: 130px;">
                                                            <div class="input-group-prepend cursor_point">
                                                                <span class="input-group-text minus"><i class="fas fa-minus"></i></span>
                                                            </div>
                                                            <input type="number" class="form-control focus text-center" value="0">
                                                            <div class="input-group-append cursor_point">
                                                                <span class="input-group-text plus"><i class="fas fa-plus"></i></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>

                                            </div>


                                        </div>

                                    </div>
                                </div>

                            </div>

                            <!------------- 3. Row ------------->
                            <!-- Dropdowns -->
                            <div class="row py-2">
                                <div class="col-md-4">

                                    <!-- Source -->
                                    <div id="modal_rent_details_object" class="view_dropdown dropdown w-100 h-auto">
                                        <button class="btn btn_hover px-2 py-1 w-100">
                                            <div class="d-flex align-items-center w-100">
                                                <span class="mr-3 font_8 d-flex py-2"><i class="fas fa-cube"></i></span>
                                                <div class="dropdown_label mr-1">
                                                    <div class="font_1 text-uppercase font_bold text-left pb-1">
                                                        Object
                                                    </div>
                                                    <div class="font_3 dropdown_name white text-left">-</div>
                                                </div>
                                                <div class="btn_toogleArrow pl-2 ml-auto font_1">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </button>
                                        <div class="dropdown_menu w-100 hidden">
                                            <ul id="modal_rent_details_objects_list" class="dropdown_ul dropdown_icon ul_icon_white font_3" data-name="" style="max-height: 15rem; overflow-y: auto;">
                                                <li class="dropdown_li" data-object="1">Apartment 01</li>
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-4 border-right border-left">

                                    <!-- Status -->
                                    <div id="modal_rent_details_custom_status" class="view_dropdown dropdown" data-id="">
                                        <button type="button" class="btn btn_hover px-2 py-1 w-100">
                                            <div class="d-flex align-items-center w-100">
                                                <span class="mr-3 font_8 d-flex py-2">
                                                    <i class="fas fa-layer-group"></i>
                                                </span>
                                                <div class="dropdown_label mr-1">
                                                    <div class="font_1 text-uppercase font_bold text-left pb-1">
                                                        Custom status
                                                    </div>
                                                    <div class="font_3 dropdown_name text-left" data-id="">-</div>
                                                </div>
                                                <div class="btn_toogleArrow pl-2 ml-auto font_1">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </button>
                                        <div class="dropdown_menu w-100 hidden">
                                            <ul class="dropdown_ul ul_icon_white font_3" style="max-height: 15rem; overflow-y: auto;" id="modal_rent_details_rent_status">
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-4">

                                    <!-- Paid -->
                                    <div id="modal_rent_details_paid" class="view_dropdown dropdown" data-id="">
                                        <button type="button" class="btn btn_hover px-2 py-1 w-100">
                                            <div class="d-flex align-items-center w-100">
                                                <span class="mr-3 font_8 d-flex py-2">
                                                    <i class="fas fa-hand-holding-usd"></i>
                                                </span>
                                                <div class="dropdown_label mr-1">
                                                    <div class="font_1 text-uppercase font_bold text-left pb-1">
                                                        Payment
                                                    </div>
                                                    <div class="font_3 dropdown_name text-left">-</div>
                                                </div>
                                                <div class="btn_toogleArrow pl-2 ml-auto font_1">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </button>
                                        <div class="dropdown_menu w-100 hidden">
                                            <ul class="dropdown_ul font_3" style="max-height: 15rem; overflow-y: auto;" id="modal_rent_details_payment_method_type">
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                            </div>


                            <!------------- 4. Row ------------->
                            <div class="bg_silver d-flex row px-3 py-3 hidden">

                                <!-- Offer -->
                                <div class="d-flex align-items-center flex_1 step_toggle" data-step="1">
                                    <div class="bg_secondary rounded-circle text-white font_2 d-flex justify-content-center align-items-center" style="width: 1.4rem; height: 1.4rem;">1</div>
                                    <div class="pl-2">
                                        <div class="line_normal">Offer</div>
                                        <div class="font_2 opacity_50 line_normal">14.10.2021</div>
                                    </div>
                                </div>

                                <!-- Confirmation -->
                                <div class="d-flex align-items-center flex_1 step_toggle" data-step="2">
                                    <div class="bg_silver03 p-2 rounded-circle text-white font_2 d-flex justify-content-center align-items-center" style="width: 1.4rem; height: 1.4rem;">2</div>
                                    <div class="pl-2">
                                        <div class="line_normal">Confirmation</div>
                                        <div class="font_2 opacity_50 line_normal">14.10.2021</div>
                                    </div>
                                </div>

                                <!-- Check-in -->
                                <div class="d-flex align-items-center flex_1 step_toggle" data-step="3">
                                    <div class="bg_silver03 p-2 rounded-circle text-white font_2 d-flex justify-content-center align-items-center" style="width: 1.4rem; height: 1.4rem;">3</div>
                                    <div class="pl-2">
                                        <div class="line_normal">Check-in</div>
                                        <div class="font_2 opacity_50 line_normal">14.10.2021</div>
                                    </div>
                                </div>

                                <!-- Check-out -->
                                <div class="d-flex align-items-center flex_1 step_toggle" data-step="4">
                                    <div class="bg_silver03 p-2 rounded-circle text-white font_2 d-flex justify-content-center align-items-center" style="width: 1.4rem; height: 1.4rem;">4</div>
                                    <div class="pl-2">
                                        <div class="line_normal">Check-out</div>
                                        <div class="font_2 opacity_50 line_normal">14.10.2021</div>
                                    </div>
                                </div>


                            </div>

                            <!------------- 5. Row ------------->
                            <div class="bg_light_silver row px-3 py-2 mb-3 hidden">

                                <!-- Step 01 -->
                                <div class="modal_step_01 w-100">
                                    <div class="row w-100 m-0">

                                        <div class="col-md-8 align-self-center">

                                            <div class="row">

                                                <div class="col-6 align-self-center">
                                                    <!-- Valid -->
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <i class="far fa-clock pr-2"></i>
                                                            Valid
                                                        </div>
                                                        <div>
                                                            <div class="input_lg position-relative" style="z-index: 1;">
                                                                <input type="number" class="form-control bg_transparent input_focus_secondary border_transparent input_hover_secondary" value="2" style="width: 7rem;" />
                                                                <span class="position-absolute" style="top: 50%; right: 2.5rem; z-index:-1; transform: translateY(-50%);">days</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 align-self-center">

                                                    <!-- Currency -->
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <i class="fas fa-money-bill pr-2"></i>
                                                            Currency
                                                        </div>
                                                        <div id="select_curr_modal" class="select_curr">
                                                            <button class="btn bg_transparent border_transparent btn_hover_secondary btn_focus_secondary d-flex py-1 px-3"><span class="label">EUR</span><i class="fas fa-chevron-down pl-2 align-self-center font_1"></i></button>
                                                            <ul class="font_4 hidden w-100">
                                                                <li>EUR</li>
                                                                <li>HRK</li>
                                                                <li>USD</li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                </div>

                                            </div>

                                        </div>

                                        <div class="col-md-4 pr-0">
                                            <!-- Buttons -->
                                            <div class="d-flex justify-content-end pt-md-0 pt-3">
                                                <button type="button" class="btn btn_border_secondary border_2 border mr-2">Send</button>

                                                <button type="button" class="btn btn_secondary">Accepted</button>
                                            </div>
                                        </div>

                                    </div>
                                </div>


                                <!--- Step 02 -->
                                <div class="modal_step_02 hidden w-100">
                                    <div class="d-flex justify-content-between w-100 m-0">

                                        <!-- Check in -->
                                        <div class="d-flex justify-content-between align-items-center w-100" style="max-width: 13rem;">
                                            <div class="pr-3 d-flex space_nowrap align-items-center">
                                                <i class="fas fa-sign-in-alt pr-2"></i><span class="opacity_50">Check-in</span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <div class="position-relative input_remove_number_arrow">
                                                    <input type="number" class="form-control bg_transparent input_focus_secondary border_transparent input_hover_secondary pr-4 text-text" style=" width: 3.6rem;" value="12" />
                                                    <span class="position-absolute position_Y_center right_0 mr-2">h</span>
                                                </div>
                                                <div class="px-2">-</div>
                                                <div class="position-relative input_remove_number_arrow">
                                                    <input type="number" class="form-control bg_transparent input_focus_secondary border_transparent input_hover_secondary pr-4 text-text" style=" width: 3.6rem;" value="14" />
                                                    <span class="position-absolute position_Y_center right_0 mr-2">h</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="pl-3">

                                            <!-- Buttons -->
                                            <div class="d-flex justify-content-end pt-md-0 pt-3">
                                                <button type="button" class="btn btn_border_secondary border_2 border mr-3">Send</button>

                                                <a id="guest_portal_btn" href="#" type="button" class="btn btn_border_secondary border_2 border" target="_blank">Guest portal</a>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                                <!--- Step 03 -->
                                <div class="modal_step_03 hidden w-100">
                                    <div class="d-flex flex-wrap w-100">
                                        <div class="modal_step_03_box w-100 m-0">

                                            <!-- Remaining -->
                                            <div class="modal_step_03_wrapper d-flex justify-content-between align-items-center pr-md-3 cursor_point"
                                                 onclick="document.querySelector('[href=\'#modal_body_price_per_day\']').click();">
                                                <div class="pr-4">Remaining:</div>
                                                <div><strong>70000.00</strong>&nbsp;EUR</div>
                                            </div>

                                            <!-- Buttons -->
                                            <div class="modal_step_03_wrapper d-flex justify-content-end flex-wrap">

                                                <div class="d-flex mr-md-3">
                                                    <button type="button" class="btn border-secondary text-secondary border mr-3 space_nowrap">No show</button>
                                                    <button type="button" class="btn btn_border_secondary border space_nowrap">Register guests</button>
                                                </div>

                                                <div class="d-flex">
                                                    <button type="button" class="btn border-secondary text-secondary border mr-3 space_nowrap">Invoice</button>
                                                    <button type="button" class="btn btn_secondary space_nowrap">Check-in</button>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <!--- Step 04 -->
                                <div class="modal_step_04 hidden w-100">
                                    <div class="d-flex flex-wrap w-100">
                                        <div class="modal_step_03_box w-100 m-0 d-flex justify-content-between">

                                            <!-- Remaining -->
                                            <div class="d-flex justify-content-between align-items-center pr-md-3">
                                                <div class="pr-4">Sec. deposit:</div>
                                                <div><strong>500.00</strong>&nbsp;EUR</div>
                                            </div>

                                            <!-- Buttons -->
                                            <div class="d-flex justify-content-end">

                                                <button type="button" class="btn border-secondary text-secondary border mr-3 space_nowrap">Send review request</button>
                                                <button type="button" class="btn btn_secondary space_nowrap">Check-out</button>

                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>



                            <!------------- 6. Row ------------->
                            <!--TAB NOTES-->
                            <!-- Tabs -->
                            <div class="modal_tabs pt-0">
                                <ul class="nav nav-tabs tab_pills_04" style="border-bottom: none;">
                                    <li>
                                        <a data-toggle="tab" href="#modal_tabs_note" class="active">
                                            <i class="far fa-clipboard pr-2"></i><span>Note</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#modal_tabs_price">
                                            <i class="fas fa-coins pr-2"></i><span>Price Note</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#modal_short_note">
                                            <i class="fas fa-coins pr-2"></i><span>Short Note</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#modal_source_note">
                                            <i class="fas fa-coins pr-2"></i><span>Source Note</span>
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <!--note-->
                                    <div id="modal_tabs_note" class="tab-pane active">
                                        <textarea id="modal_rent_details_tabs_note" cols="30" rows="5" class="form-control focus"
                                                  placeholder="Note that only you can see..."></textarea>
                                    </div>
                                    <!--price note-->
                                    <div id="modal_tabs_price" class="tab-pane">
                                        <textarea id="modal_rent_details_tabs_price_note" cols="30" rows="5" class="form-control focus"
                                                  placeholder="Price note"></textarea>
                                    </div>
                                    <!--short note-->
                                    <div id="modal_short_note" class="tab-pane">
                                        <textarea id="modal_rent_details_tabs_short_note" cols="30" rows="5" class="form-control focus"
                                                  placeholder="Short note"></textarea>
                                    </div>
                                    <!--Source note-->
                                    <div id="modal_source_note" class="tab-pane">
                                        <textarea id="modal_rent_details_tabs_source_note" cols="30" rows="5" class="form-control focus"
                                                  placeholder="Source note"></textarea>
                                    </div>
                                </div>
                            </div>



                            <!-- test calendar -->

                        </div>

                        <!--  buttons for saving-->
                        <div class="modal-footer justify-content-between">
                            <button type="button" class="btn btn_bordered btn-danger border m-1" onclick="modal_details_rent.bl.delete_reservation();"><i class="pr-2 far fa-trash-alt"></i>Remove</button>

                            <a id="guest_portal_link" href="#" type="button" class="btn btn-info" target="_blank">
                                <i class="fas fa-user-lock"></i> &nbsp; Guest portal
                            </a>

                            <button type="button" class="btn btn_secondary m-1" onclick="modal_details_rent.bl.save_rent();">
                                <i class="fas fa-save pr-2"></i>Save
                            </button>
                        </div>
                    </div>

                    <!-- prices per day & total -->
                    <div id="modal_body_price_per_day" class="tab-pane">

                        <div style="max-height: calc(100vh - 290px); overflow-y: auto;">

                            <div class="modal-body">


                                <!-- Average per night -->
                                <div class="d-flex flex-wrap justify-content-between pt-3">
                                    <div class="pr-2 my-2">Average per nights</div>
                                    <div class="d-flex flex-wrap">

                                        <!-- Currency picker-->




                                        <div class="form-group mr-4 w-10">
                                            <div id="modal_rent_details_currency_dropdown" class="select">
                                                <button class="custom-select focus" id="modal_rent_currency_id" data-id="2">EUR</button>
                                                <i class="fas fa-angle-down"></i>
                                                <ul class="hidden select_ul" onclick="modal_details_rent.bl.change_currency();">
                                                    <li class="select_li" data-id="EUR">EUR</li>
                                                    <li class="select_li" data-id="HRK">HRK</li>
                                                    <li class="select_li" data-id="USD">USD</li>
                                                </ul>
                                            </div>
                                        </div>


                                        <div class="form-group">
                                            <input type="text" class="form-control focus text-left" value="5" style="max-width: 4rem;"
                                                   disabled id="modal_rent_details_days">
                                            <span class="value font_2"><i class="fas fa-moon"></i></span>
                                        </div>
                                        <div class="mx-2 mt-2">nights x</div>
                                        <div class="form-group input_remove_number_arrow">
                                            <input type="number" class="form-control focus pr-5 text-right" style="max-width: 9rem;" id="modal_rent_details_average_price" onchange="modal_details_rent.bl.calculate_prices_per_day();">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_average_price_label">EUR</span>
                                        </div>
                                        <div class="mx-2 mt-2">=</div>
                                        <div class="form-group input_remove_number_arrow ">
                                            <input type="number" class="form-control focus pr-5 text-right" style="max-width: 9rem;" id="modal_rent_details_price_full" onchange="modal_details_rent.bl.price_change();">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_price_full_label">EUR</span>
                                        </div>
                                    </div>
                                </div>

                                <!--<div class="d-flex justify-content-between pb-2">
                                    <div class="pr-2">Exchange</div>
                                    <div>
                                        <input type="text" class="inside_input text-right" value="7.45" id="modal_rent_details_exchange">
                                    </div>
                                </div>-->
                                <!-- Markup -->
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="pr-2">Markup</div>
                                    <div class="form-group mb-2 d-flex">
                                        <img src="/assets/images/icons/portals/airbnb.svg" class="mr-2 align-self-center" style="height: 2.2rem; width: 2.2rem;" id="modal_rent_details_markup_source" />
                                        <div class="d-flex position-relative input_remove_number_arrow">
                                            <input type="number" value="0" class="form-control focus pr-4 text-right" style="max-width: 5rem;" id="modal_rent_details_source_provision_percent" onchange="modal_details_rent.bl.calculate_provision(); modal_details_rent.bl.calculate_total();">
                                            <span class="value font_1 opacity_50"><i class="fas fa-percent"></i></span>
                                        </div>
                                        <div class="mx-2 mt-2">=</div>
                                        <div class="position-relative input_remove_number_arrow">
                                            <input type="number" value="0" class="form-control focus pr-5 text-right" style="max-width: 9rem;" onchange="modal_details_rent.bl.calculate_total(); modal_details_rent.bl.calculate_provision_percent();" id="modal_rent_details_source_provision">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_source_provision_label">EUR</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Discount -->
                                <div class="d-flex justify-content-between align-items-center mb-2 hidden">
                                    <div class="pr-2 mt-2">Discount</div>
                                    <div class="form-group mb-2 d-flex">
                                        <div class="d-flex position-relative input_remove_number_arrow">
                                            <input type="number" class="form-control focus pr-4 text-right" style="max-width: 5rem;" id="modal_rent_details_discount" onchange="modal_details_rent.bl.calculate_discount(); modal_details_rent.bl.calculate_total();">
                                            <span class="value font_1 opacity_50"><i class="fas fa-percent"></i></span>
                                        </div>
                                        <div class="mx-2 mt-2">=</div>
                                        <div class="form-group m-0 input_remove_number_arrow">
                                            <input type="number" class="form-control focus pr-5 text-right" style="max-width: 9rem;" onchange="modal_details_rent.bl.calculate_total(); modal_details_rent.bl.calculate_discount_percent();" id="modal_rent_details_discount_amount">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_discount_amount_label">EUR</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Accommodation total -->
                                <div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="font_bold pr-2">Accommodation total</div>
                                        <div class="form-group m-0">
                                            <input type="text" class="form-control text-right pr-5 font_bold" value="0" readonly="" disabled="" id="modal_rent_details_total" style="max-width: 9rem;">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_total_label">EUR</span>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="border-bottom"></div>

                            <div class="modal-body">

                                <!-- Table -->
                                <div>
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="overflow-auto" id="modal_rent_details_items_table">
                                            <table class="table modal_table m-0">
                                                <thead>
                                                    <tr class="opacity_50">
                                                        <th scope="col" class="text-left pl-0 font_3">Extra charges</th>
                                                        <th scope="col" class="text-center font_3">Price</th>
                                                        <th scope="col" class="text-center font_3">Amount</th>
                                                        <th scope="col" class="text-center font_3">Tax</th>
                                                        <th scope="col" class="text-center font_3">Total</th>
                                                        <th scope="col"></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="modal_rent_details_tbody">

                                                    <!-- Add new item manually -->
                                                    <tr id="modal_rent_details_tr">

                                                        <td class="px-0 border-top-0 pb-0" style="min-width: 11rem;">
                                                            <div class="form-group m-0">
                                                                <div class="form-group m-0">
                                                                    <input type="text" class="form-control focus" placeholder="Extra charge" id="modal_rent_details_item_name">
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="pr-0 border-top-0 pb-0">
                                                            <div class="form-group mb-0 position-relative input_remove_number_arrow">
                                                                <input type="number" value="" class="form-control focus text-center pr-5" id="modal_rent_details_item_price" onchange="modal_details_rent.bl.total_item_price_new();">
                                                                <span class="value font_2 opacity_50" id="modal_rent_details_price_amount_label">EUR</span>
                                                            </div>
                                                        </td>
                                                        <td class="pr-0 border-top-0 pb-0" style="max-width: 5rem;">
                                                            <div class="form-group mb-0 input_remove_number_arrow">
                                                                <input type="number" value="" class="form-control focus text-center" id="modal_rent_details_item_amount" onchange="modal_details_rent.bl.total_item_price_new();">
                                                            </div>
                                                        </td>
                                                        <td class="pr-0 border-top-0 pb-0">
                                                            <div class="form-group mb-0 input_remove_number_arrow">
                                                                <input type="number" value="" class="form-control focus text-center pr-4" id="modal_rent_details_item_tax" onchange="modal_details_rent.bl.total_item_price_new();">
                                                                <span class="value font_1 opacity_50"><i class="fas fa-percent"></i></span>
                                                            </div>
                                                        </td>
                                                        <td class="border-top-0 pr-0 pb-0">
                                                            <div class="form-group mb-0">
                                                                <input type="text" class="form-control text-right pr-5" value="0" readonly disabled id="modal_rent_details_item_total">
                                                                <span class="value font_2 opacity_50" id="modal_rent_details_item_total_label">EUR</span>
                                                            </div>
                                                        </td>
                                                        <td class="">
                                                            <button class="btn btn_border_secondary" onclick="modal_details_rent.bl.rent_item_add();" id="modal_rent_deaails_add_extra_charges" data-toggle="tooltip" data-placement="top">
                                                                <i class="fas fa-plus p-0"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end mt-2">
                                    <button id="btn_save_item" class="btn btn_secondary" onclick="modal_new_item_rent.ui.show_modal('modal_new_rent_item');">
                                        <i class="fas fa-plus pr-2"></i>Add item
                                    </button>
                                </div>

                            </div>

                            <div class="border-bottom"></div>

                            <div class="modal-body">

                                <!-- Extra charges total -->
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="font_bold pr-2">Extra charges total</div>
                                    <div class="form-group m-0">
                                        <input type="text" class="form-control focus pr-5 text-right font_bold" style="max-width: 9rem;" value="0" disabled id="modal_rent_details_price_extra_price">
                                        <span class="value font_2 opacity_50" id="modal_rent_details_price_extra_price_label">EUR</span>
                                    </div>
                                </div>

                            </div>

                            <div class="border-bottom" style="background-color:#dee2e6!important;"></div>

                            <div class="modal-body pb-0">

                                <!-- Advance -->
                                <div class="d-flex flex-wrap align-items-center justify-content-between">
                                    <div class="mb-3">
                                        <div>Advance</div>
                                        <div class="opacity_50 font_3 line_normal">30. Feb 2022</div>
                                    </div>
                                    <div class="d-flex flex-wrap input_remove_number_arrow">
                                        <div class="form-group mb-3">
                                            <input type="number" class="form-control focus font_medium text-right pr-4"
                                                   value="30.00" style="max-width: 9rem;" id="modal_rent_details_advance_percent" onchange="modal_details_rent.bl.change_advance_price();">
                                            <span class="value font_1 opacity_50"><i class="fas fa-percent"></i></span>
                                        </div>
                                        <div class="mx-2 mt-2">=</div>
                                        <div class="form-group mb-3 mr-3">
                                            <input type="number" class="form-control focus font_medium text-right"
                                                   value="0" style="max-width: 9rem; padding-right: 3.5rem;" id="modal_rent_details_advance" onchange="modal_details_rent.bl.change_advance_percent();">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_advance_label">EUR</span>
                                        </div>
                                        <button id="advance_button" onclick="modal_details_rent.bl.rent_to_invoice(1, 'advance');" class="btn btn_border_secondary mb-3">Invoice</button>
                                    </div>
                                </div>

                                <!-- Remaining -->
                                <div class="d-flex flex-wrap align-items-center justify-content-between">
                                    <div class="pr-2 mb-3">
                                        <div>Remaining</div>
                                        <div class="opacity_50 font_3 line_normal">by 04. Jul 2022</div>
                                    </div>
                                    <div class="d-flex flex-wrap">
                                        <div class="form-group">
                                            <input type="text" class="form-control focus font_medium pr-4 text-right"
                                                   value="70.00" style="max-width: 9rem;" id="modal_details_rent_remaining_percent" disabled>
                                            <span class="value font_1 opacity_50"><i class="fas fa-percent"></i></span>
                                        </div>
                                        <div class="mx-2 mt-2">+</div>
                                        <div class="form-group">
                                            <input type="text" class="form-control focus font_medium pr-5 text-right"
                                                   value="62.50" style="max-width: 9rem;" id="modal_details_rent_remaining_extra" disabled>
                                            <span class="value font_2 opacity_50" id="modal_rent_details_remaining_extra_label">EUR</span>
                                        </div>
                                        <div class="mx-2 mt-2">=</div>
                                        <div class="form-group mr-3">
                                            <input type="text" class="form-control focus font_medium pr-5 text-right"
                                                   value="263.75" style="max-width: 9rem; padding-right: 3.5rem;" id="modal_rent_details_remaining" disabled>
                                            <span class="value font_2 opacity_50" id="modal_rent_details_remaining_label">EUR</span>
                                        </div>
                                        <button id="remaining_button" class="btn btn_border_secondary mb-3" onclick="modal_details_rent.bl.rent_to_invoice(0, 'final');">Invoice</button>
                                    </div>
                                </div>

                            </div>

                            <div class="border-bottom"></div>

                            <!-- total price -->
                            <div class="modal-body pb-0">

                                <!-- Total -->
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="font_bold">Total</div>

                                    <div class="d-flex flex-wrap input_remove_number_arrow">

                                        <div class="form-group">
                                            <input type="number" class="form-control text-right pr-5 font_bold" value="0" id="modal_rent_details_price_sum" onchange="modal_details_rent.bl.calculate_local_sum()" style="max-width: 9rem;">
                                            <span class="value font_2 opacity_50" id="modal_rent_details_price_sum_label">EUR</span>
                                        </div>
                                        <div class="mx-2 mt-2">x</div>
                                        <div class="form-group">
                                            <input type="number" class="form-control text-right pr-5 font_bold" value="1" id="modal_rent_details_exchange" onchange="modal_details_rent.bl.calculate_local_sum()" style="max-width: 9rem;">
                                            <span class="value font_2 opacity_50">EXCH</span>
                                        </div>
                                        <div class="mx-2 mt-2">=</div>


                                        <div class="flex-wrap d-flex">
                                            <div class="form-group mr-3">
                                                <input type="number" class="form-control font_bold focus text-right pr-5" text-right style="max-width: 9rem" value="350.00" disabled id="modal_rent_details_price_sum_local" />
                                                <span class="value font_2 opacity_50" id="modal_rent_details_price_sum_local_label">EUR</span>
                                            </div>
                                            <button id="total_btn" class="btn btn_border_secondary mb-3" onclick="modal_details_rent.bl.rent_to_invoice(0, 'final');">Invoice</button>
                                        </div>

                                    </div>


                                </div>

                            </div>

                        </div>

                        <div class="modal-footer justify-content-between">
                            <button type="button" class="btn btn_bordered btn-danger border m-1" onclick="modal_details_rent.bl.delete_reservation();"><i class="pr-2 far fa-trash-alt"></i>Remove</button>
                            <button type="button" class="btn btn_secondary" onclick="modal_details_rent.bl.save_prices()">
                                <i class="fas fa-save pr-2"></i>Save
                            </button>
                        </div>

                    </div>

                    <!-- guests list -->
                    <div id="modal_body_guests_list" class="tab-pane">
                        <div class="modal-body pb-0">
                            <div id="bills" class="modal_body_bill">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="font_6 font_bold"><i class="fas fa-file-alt pr-2"></i>Lists of guests</div>
                                    <button class="btn btn_secondary" onclick="document.querySelector('#modal_body_add_guest_tab').click(); modal_details_rent.bl.load_date_add_guest_tab();"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="bill-invoices-table pt-3">
                                    <div class="overflow-auto">
                                        <table class="table table-bill m-0" style="min-width: 500px;">
                                            <thead>
                                                <tr>
                                                    <th></th>
                                                    <th>Name</th>
                                                    <th>Years</th>
                                                    <th>Days</th>
                                                    <th>Price</th>
                                                    <th></th>
                                                    <th class="text-right">Sync</th>
                                                </tr>
                                            </thead>
                                            <tbody id="modal_rent_details_guest_tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="text-right">
                                <!--<button type="button" class="btn btn_secondary" data-dismiss="modal">
                                    <i class="fas fa-save pr-2"></i>Save
                                </button>-->
                            </div>
                        </div>
                    </div>

                    <!-- bills -->
                    <div id="modal_body_bills" class="tab-pane">
                        <div class="modal-body">
                            <div id="bills" class="modal_body_bill">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="font_6 font_bold"><i class="fas fa-file-alt pr-2"></i>Bills</div>
                                    <button class="btn btn_secondary"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="bill-invoices-table pt-3">
                                    <div class="overflow-auto">
                                        <table class="table table-bill m-0" style="min-width: 500px;">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>PDF</th>
                                                    <th>No.</th>
                                                    <th>Type</th>
                                                    <th>Price</th>
                                                    <th class="text-right">Payment</th>
                                                </tr>
                                            </thead>
                                            <tbody id="modal_rent_details_invoices_tbody">
                                                <tr class="tr-bill">
                                                    <td>01.07.2020</td>
                                                    <td>6-2020</td>
                                                    <td>Račun</td>
                                                    <td>400,00 € / 3.000,00 €</td>
                                                    <td class="text-right">
                                                        <label onclick="modal_details_rent.ui.tr_success(this)"
                                                               class="checkbox">
                                                            <input type="checkbox" checked>
                                                            <span class="check check_xl"></span>
                                                        </label>
                                                    </td>
                                                </tr>
                                                <tr class="tr-bill">
                                                    <td>01.07.2020</td>
                                                    <td>6-2020</td>
                                                    <td>Račun</td>
                                                    <td>400,00 € / 3.000,00 €</td>
                                                    <td class="text-right">
                                                        <label onclick="modal_details_rent.ui.tr_success(this)"
                                                               class="checkbox">
                                                            <input type="checkbox">
                                                            <span class="check check_xl"></span>
                                                        </label>
                                                    </td>
                                                </tr>
                                                <tr class="tr-bill">
                                                    <td>01.07.2020</td>
                                                    <td>6-2020</td>
                                                    <td>Račun</td>
                                                    <td>400,00 € / 3.000,00 €</td>
                                                    <td class="text-right">
                                                        <label onclick="modal_details_rent.ui.tr_success(this)"
                                                               class="checkbox">
                                                            <input type="checkbox">
                                                            <span class="check check_xl"></span>
                                                        </label>
                                                    </td>
                                                </tr>
                                                <tr class="tr-bill">
                                                    <td>01.07.2020</td>
                                                    <td>6-2020</td>
                                                    <td>Račun</td>
                                                    <td>400,00 € / 3.000,00 €</td>
                                                    <td class="text-right">
                                                        <label onclick="modal_details_rent.ui.tr_success(this)"
                                                               class="checkbox">
                                                            <input type="checkbox" checked>
                                                            <span class="check check_xl"></span>
                                                        </label>
                                                    </td>
                                                </tr>
                                                <tr class="tr-bill">
                                                    <td>01.07.2020</td>
                                                    <td>6-2020</td>
                                                    <td>Račun</td>
                                                    <td>400,00 € / 3.000,00 €</td>
                                                    <td class="text-right">
                                                        <label onclick="modal_details_rent.ui.tr_success(this)"
                                                               class="checkbox">
                                                            <input type="checkbox">
                                                            <span class="check check_xl"></span>
                                                        </label>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="text-right">
                                <button type="button" class="btn btn_secondary" data-dismiss="modal">
                                    <i class="fas fa-save pr-2"></i>Save
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- credit cards -->
                    <div id="modal_body_credit_card" class="tab-pane">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="font_6 font_bold pb-2">
                                        <i class="far fa-credit-card pr-2"></i>Insert card

                                    </div>
                                    <div class="modal_credit_card">
                                        <div class="modal_credit_card_item01 border">
                                            <div class="text-uppercase font_3 font_medium pb-2">
                                                Unesite Vaš PIN
                                            </div>
                                            <div class="form-group input_remove_number_arrow">
                                                <input type="number" class="form-control focus" id="modal_card_details_pin1" placeholder="PIN1">
                                            </div>
                                            <div class="form-group input_remove_number_arrow">
                                                <input type="number" class="form-control focus" id="modal_card_details_pin2" placeholder="PIN2">
                                            </div>
                                            <button class="btn btn_secondary w-100">Prikaži</button>
                                        </div>
                                        <div class="modal_credit_card_item02 w-100 border">
                                            <div class="form-group">
                                                <input type="text" class="form-control focus" placeholder="Type" id="modal_card_details_card_type">
                                            </div>
                                            <div class="form-group input_remove_number_arrow">
                                                <input type="number" class="form-control focus" placeholder="Broj kartice" id="modal_card_details_card_number">
                                            </div>
                                            <div class="expires d-flex flex-wrap align-items-center">
                                                <div class="form-group d-flex input_remove_number_arrow">
                                                    <input type="number" class="form-control focus mr-2" placeholder="Od" id="modal_card_details_date_from">
                                                    <span class="mt-1">/</span>
                                                    <input type="number" class="form-control focus ml-2" placeholder="Do" id="modal_card_details_date_until">
                                                </div>
                                                <div class="form-group w-100 input_remove_number_arrow">
                                                    <input type="number" class="form-control focus" placeholder="CVV" id="modal_card_details_cvv">
                                                </div>
                                            </div>
                                            <div class="form-group m-0">
                                                <input type="text" class="form-control focus" placeholder="Ime i Prezime" id="modal_card_details_owner_name">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 modal_credit_card_access pt-md-0 pt-3">
                                    <div class="font_6 font_bold pb-2">
                                        <i class="fas fa-user-check pr-2"></i>Login
                                        pristupa
                                    </div>
                                    <div><span class="font_2 mr-1">01.01.2020</span>Neven Palčec</div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer d-flex justify-content-between">
                            <button class="btn btn_silver" onclick="modal_details_rent.bl.reset_card_data();">Reset</button>
                            <button type="button" class="btn btn_secondary" data-dismiss="modal" onclick="modal_details_rent.bl.save_card_data();">
                                <i class="fas fa-save pr-2"></i>Save
                            </button>
                        </div>
                    </div>

                    <!-- messages -->
                    <div id="modal_body_messages" class="tab-pane">
                        <div class="modal-body">
                            <div class="pb-2 d-md-flex justify-content-between">
                                <div class="font_6 font_bold pb-2">Sent emails</div>
                                <div class="d-flex flex-wrap justify-content-end" style="gap: 1rem;">

                                    <div id="modal_mail_send" class="view_dropdown toggle ml-auto">
                                        <button class="btn btn_secondary">
                                            <div class="d-flex align-items-center">
                                                <span class="font_4"><i class="fas fa-file-alt pr-2"></i> Confirmation</span>
                                                <span class="font_1 ml-2"><i class="fas fa-chevron-down"></i></span>
                                            </div>
                                        </button>
                                        <div class="dropdown_menu hidden w-100" style="right: 0;">
                                            <ul class="dropdown_ul font_3 dropdown_ul_max_height">
                                                <li class="dropdown_li">
                                                    <a class="dropdown_a" onclick="modal_details_rent.bl.send_confirmation_mail();">Send</a>
                                                </li>
                                                <li class="dropdown_li">
                                                    <a href="/rents/email/" target="_blank" class="dropdown_a" id="modal_rent_details_confirmation_preview">Preview</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div id="modal_mail_send_voucher" class="view_dropdown toggle">
                                        <button class="btn btn_secondary">
                                            <div class="d-flex align-items-center">
                                                <span class="font_4"><i class="fas fa-file-alt pr-2"></i> Voucher</span>
                                                <span class="font_1 ml-2"><i class="fas fa-chevron-down"></i></span>
                                            </div>
                                        </button>
                                        <div class="dropdown_menu hidden w-100" style="right: 0;">
                                            <ul class="dropdown_ul font_3 dropdown_ul_max_height">
                                                <li class="dropdown_li">
                                                    <a class="dropdown_a" onclick="modal_details_rent.bl.send_voucher_mail();">Send</a>
                                                </li>
                                                <li class="dropdown_li">
                                                    <a href="" class="dropdown_a" target="_blank" id="modal_rent_details_voucher_preview">Preview</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div id="modal_mail_send_offer" class="view_dropdown toggle hidden">
                                        <button class="btn btn_secondary">
                                            <div class="d-flex align-items-center">
                                                <span class="font_4"><i class="fas fa-file-alt pr-2"></i> Offer</span>
                                                <span class="font_1 ml-2"><i class="fas fa-chevron-down"></i></span>
                                            </div>
                                        </button>
                                        <div class="dropdown_menu hidden w-100" style="right: 0;">
                                            <ul class="dropdown_ul font_3 dropdown_ul_max_height">
                                                <li class="dropdown_li">
                                                    <a class="dropdown_a" onclick="modal_details_rent.bl.send_offer_mail();">Send</a>
                                                </li>
                                                <li class="dropdown_li">
                                                    <a href="#" class="dropdown_a" target="_blank" id="modal_rent_details_offer_preview">Preview</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                            </div>


                            <table class="table mt-2">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th class="text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="modal_body_messages_tbody_id">
                                    <tr>
                                        <td>Test</td>
                                        <td>07.07.2020.</td>
                                        <td class="text-right text-success"><i class="fas fa-check"></i></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="modal_message_info" id="modal_rent_details_create_info">
                                <i class="fas fa-circle pr-2"></i>Rezervacija primljena
                                u 01.07.2020 - 11:50
                            </div>
                        </div>
                    </div>

                    <!-- tab for add guests-->
                    <div id="modal_body_add_guest" class="tab-pane">
                        <div class="modal-body">
                            <div class="d-flex justify-content-between">
                                <div class="font_6 font_bold pb-0"><i class="fas fa-user-plus"></i> Add guest</div>
                                <div class="font_6 font_bold pr-5">Existing guest</div>
                            </div>
                            <hr />
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="mb-1">Date from:</label>
                                                <input type="date" class="form-control focus" id="modal_add_guest_details_date_from" required>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="mb-1">Date until:</label>
                                                <input type="date" class="form-control focus" id="modal_add_guest_details_date_until" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">First name</label>
                                                <input type="text" class="form-control focus" id="modal_add_guest_details_first_name" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Last name</label>
                                                <input type="text" class="form-control focus" id="modal_add_guest_details_last_name" required>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">City</label>
                                                <input type="text" class="form-control focus" id="modal_add_guest_details_city" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Country</label>
                                                <div id="modal_add_guest_details_select_country" class="select">

                                                    <div id="modal_add_dropdown_example_country_search" class="light_dropdown icon search">
                                                        <div class="light_dropdown-btn light_dropdown-toggle" required_dropdown>
                                                            <input type="text" class="light_dropdown-input bg-white" id="modal_add_guest_details_country" data-value="hr">
                                                            <div class="light_dropdown-box">

                                                            </div>
                                                        </div>
                                                        <ul class="light_dropdown-menu hidden" id="modal_add_guest_details_countries_ul">

                                                            <!-- Only text no country -->
                                                            <li class="no_result hidden" data-value="">Not found</li>

                                                            <!-- Normal click to put no country on btn -->
                                                            <!--<li class="light_dropdown-item" data-value="">
                                                                <div class="light_dropdown-label">No Country</div>
                                                            </li>-->
                                                            <!-- List -->
                                                            <!--<li class="light_dropdown-item" data-value="hr">
                                                                <div class="light_dropdown-icon"><img src="./assets/icons/flags/hr.svg" alt="icon"></div>
                                                                <div class="light_dropdown-label">Croatia</div>
                                                            </li>
                                                            <li class="light_dropdown-item" data-value="at">
                                                                <div class="light_dropdown-icon"><img src="./assets/icons/flags/at.svg" alt="icon"></div>
                                                                <div class="light_dropdown-label">Austria</div>
                                                            </li>
                                                            <li class="light_dropdown-item" data-value="de">
                                                                <div class="light_dropdown-icon"><img src="./assets/icons/flags/de.svg" alt="icon"></div>
                                                                <div class="light_dropdown-label">Njemačka</div>
                                                            </li>-->

                                                        </ul>
                                                    </div>

                                                    <!--<button class="custom-select focus" id="modal_add_guest_details_country" data-code1=""></button>
                                                    <i class="fas fa-angle-down"></i>
                                                    <ul class="select_ul hidden" id="modal_add_guest_details_countries_ul">-->
                                                    <!--adding countries via template-->
                                                    <!--</ul>-->

                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Date birth</label>
                                                <input type="date" class="form-control focus" id="modal_add_guest_details_date_birth" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Gender</label>
                                                <div class="d-flex flex-wrap mt-1">
                                                    <div class="custom_radio radio_lg mr-4">
                                                        <label for="modal_add_guest_details_sex_type_M">
                                                            Male
                                                            <input type="radio" id="modal_add_guest_details_sex_type_M" checked="checked" name="add_guest_details_sex_radio">
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                    <div class="custom_radio radio_lg">
                                                        <label for="modal_add_guest_details_sex_type_F">
                                                            Female
                                                            <input type="radio" id="modal_add_guest_details_sex_type_F" name="add_guest_details_sex_radio">
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Type of document</label>
                                                <div id="modal_add_guest_details_select_type_of_document" class="select">
                                                    <button class="custom-select focus" id="modal_add_guest_details_country_btn" required_dropdown></button>
                                                    <i class="fas fa-angle-down"></i>
                                                    <ul class="select_ul hidden" id="modal_add_guest_details_type_of_document_ul">
                                                        <li class="select_li" data-id="002"> Osobna putovnica (strana) </li>
                                                        <li class="select_li" data-id="027"> Osobna iskaznica (strana) </li>
                                                        <li class="select_li" data-id="032"> Vozačka dozvola (strana) </li>
                                                        <li class="select_li" data-id="051"> Osobna iskaznica (domaća) </li>
                                                        <li class="select_li" data-id="028"> Osobna putovnica (domaća) </li>
                                                        <li class="select_li" data-id="999"> Zdrastvena iskaznica </li>
                                                        <li class="select_li" data-id="037"> Službena putovnica (domaća) </li>
                                                        <li class="select_li" data-id="033"> Dječja putovnica (domaća) </li>
                                                        <li class="select_li" data-id="103"> Vozačka dozvola (domaća) </li>
                                                        <li class="select_li" data-id="004"> Zajednička putovnica (strana) </li>
                                                        <li class="select_li" data-id="003"> Obiteljska putovnica (strana) </li>
                                                        <li class="select_li" data-id="005"> Dječja putovnica (strana) </li>
                                                        <li class="select_li" data-id="006"> Diplomatska putovnica (strana) </li>
                                                        <li class="select_li" data-id="007"> Službena putovnica (strana) </li>
                                                        <li class="select_li" data-id="008"> Pomorska knjižica (strana) </li>
                                                        <li class="select_li" data-id="009"> Brodarska knjižica (strana) </li>
                                                        <li class="select_li" data-id="011"> Putni list za strance - izdan od RH </li>
                                                        <li class="select_li" data-id="012"> Putna isprava za izbjeglice </li>
                                                        <li class="select_li" data-id="013"> Putna isprava za osobe bez državljanstva </li>
                                                        <li class="select_li" data-id="022"> Potvrda o oduzimanju ili zadržavanju putne isprave </li>
                                                        <li class="select_li" data-id="023"> Potvrda o prijavi gubitka ili nestanka putne isprave </li>
                                                        <li class="select_li" data-id="024"> Osobna iskaznica za stranca - izdana od RH </li>
                                                        <li class="select_li" data-id="025"> Posebna osobna iskaznica - diplomatska konzularna službena </li>
                                                        <li class="select_li" data-id="026"> Isprave izdane na temelju međ. ugovora </li>
                                                        <li class="select_li" data-id="029"> Pogranična propusnica (strana) </li>
                                                        <li class="select_li" data-id="030"> Izbjeglički karton izdan od RH </li>
                                                        <li class="select_li" data-id="034"> Putni list za strance (strani) </li>
                                                        <li class="select_li" data-id="039"> Ostalo </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Document number</label>
                                                <input type="text" class="form-control focus" id="modal_add_guest_details_document_number" required>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Place of residence</label>
                                                <input type="text" class="form-control focus" value="" id="modal_add_guest_details_place_of_residence" required>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Country of residence</label>

                                                <div id="modal_add_guest_details_select_country_residence" class="select">

                                                    <div id="modal_add_dropdown_example_country_search_residence" class="light_dropdown icon search">
                                                        <div class="light_dropdown-btn light_dropdown-toggle" required_dropdown>
                                                            <input type="text" class="light_dropdown-input bg-white" id="modal_add_guest_details_country_residence" data-value="hr">
                                                            <div class="light_dropdown-box">

                                                            </div>
                                                        </div>
                                                        <ul class="light_dropdown-menu hidden" id="modal_add_guest_details_countries_ul_residence">
                                                            <!-- Only text no country -->
                                                            <li class="no_result hidden" data-value="">Not found</li>
                                                        </ul>
                                                    </div>
                                                </div>

                                                <!--<div id="modal_add_guest_details_select_country_of_birth" class="select">
                                                    <button class="custom-select focus" id="modal_add_guest_details_select_country_btn" data-code1=""></button>
                                                    <i class="fas fa-angle-down"></i>
                                                    <ul class="select_ul hidden" id="modal_add_guest_details_select_country_of_residence_ul">
                                                        <li class="select_li" data-id="1"><span><img src="./assets/images/icons/flags/ad.svg" alt=""></span>Example</li>
                                                        <li class="select_li" data-id="2"><span><img src="./assets/images/icons/flags/at.svg" alt=""></span>Austria</li>
                                                        <li class="select_li" data-id="3">
                                                            <span><img src="./assets/images/icons/flags/es.svg" alt=""></span>Spain
                                                        </li>
                                                        <li class="select_li" data-id="4"><span><img src="./assets/images/icons/flags/fi.svg" alt=""></span>Finska</li>
                                                        <li class="select_li" data-id="5"><span><img src="./assets/images/icons/flags/fr.svg" alt=""></span>France</li>
                                                        <li class="select_li" data-id="6"><span><img src="./assets/images/icons/flags/hr.svg" alt=""></span>Croatia</li>
                                                    </ul>
                                                </div>-->
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="mb-1">Citizenship</label>
                                                <div id="modal_add_guest_details_select_country_citizenship" class="select">

                                                    <div id="modal_add_dropdown_example_country_search_citizenship" class="light_dropdown icon search">
                                                        <div class="light_dropdown-btn light_dropdown-toggle" required_dropdown>
                                                            <input type="text" class="light_dropdown-input bg-white" id="modal_add_guest_details_country_citizenship" data-value="hr">
                                                            <div class="light_dropdown-box">

                                                            </div>
                                                        </div>
                                                        <ul class="light_dropdown-menu hidden" id="modal_add_guest_details_countries_ul_citizenship">
                                                            <!-- Only text no country -->
                                                            <li class="no_result hidden" data-value="">Not found</li>
                                                        </ul>
                                                    </div>

                                                </div>
                                                <!--<div id="modal_add_guest_details_select_citizenship" class="select">
                                                    <button class="custom-select focus" id="modal_add_guest_details_select_citizenship_btn"></button>
                                                    <i class="fas fa-angle-down"></i>
                                                    <ul class="select_ul hidden" id="modal_add_guest_details_select_citizenship_ul">
                                                        <li class="select_li" data-id="1"><span><img src="./assets/images/icons/flags/ad.svg" alt=""></span>Example</li>
                                                        <li class="select_li" data-id="2"><span><img src="./assets/images/icons/flags/at.svg" alt=""></span>Austria</li>
                                                        <li class="select_li" data-id="3">
                                                            <span><img src="./assets/images/icons/flags/es.svg" alt=""></span>Spain
                                                        </li>
                                                        <li class="select_li" data-id="4"><span><img src="./assets/images/icons/flags/fi.svg" alt=""></span>Finska</li>
                                                        <li class="select_li" data-id="5"><span><img src="./assets/images/icons/flags/fr.svg" alt=""></span>France</li>
                                                        <li class="select_li" data-id="6"><span><img src="./assets/images/icons/flags/hr.svg" alt=""></span>Croatia</li>
                                                    </ul>
                                                </div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12">

                                    <div id="modal_rent_details_existing_guest_div">
                                        <!--<div>
                                            <div>
                                                <img src="./assets/images/icons/flags/HR.svg" height="15" alt="">
                                                <span>Domagoj Krmpotic</span>
                                            </div>
                                            <div>
                                                <span>Doc. No. </span>
                                                <span class="border-left mx-2 border-dark"></span>
                                                <span>12312312</span>
                                            </div>
                                        </div>
                                        <hr />
                                        <div>
                                            <div>
                                                <img src="./assets/images/icons/flags/HR.svg" height="15" alt="">
                                                <span>Domagoj Krmpotic</span>
                                            </div>
                                            <div>
                                                <span>Doc. No. </span>
                                                <span class="border-left mx-2 border-dark"></span>
                                                <span>12312312</span>
                                            </div>
                                        </div>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer justify-content-between">
                            <div class="m-0">
                                <button class="btn btn_silver m-1" data-dismiss="modal">Close</button>
                                <button class="btn btn_secondary m-1" onclick="document.querySelector('#modal_body_guests_list_tab').click();modal_details_rent.bl.clear_add_guest();">Back</button>
                            </div>
                            <button class="btn btn_secondary m-1" onclick="modal_details_rent.bl.add_guest();"><i class="fas fa-plus pr-2"></i>Add</button>
                        </div>
                    </div>

                    <!-- tab for edit guest-->
                    <div id="modal_body_edit_guest" class="tab-pane">
                        <div class="modal-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="font_6 font_bold mb-2"><i class="fas fa-user-edit pr-2"></i>Edit guest</div>
                                <div>
                                    <div class="d-flex align-content-center">
                                        <!--<div id="modal_rent_details_evisitor_checkin" class="bg-success px-2 py-1 text-white mr-2 rounded">P</div>
                                        <div id="modal_rent_details_evisitor_verified" class="bg-success px-2 py-1 text-white rounded">V</div>-->

                                        <div class="mr-2 mt-1 hidden" id="modal_rent_details_evisitor_icon"><img src="/assets/images/icons/icon-evisitor.svg" alt="Evisitor" style="width:1.5rem; height:1.5rem" /> </div>
                                        <button class="btn btn_secondary" onclick="modal_details_rent.bl.add_guest_to_evisitor();">Add to evisitor</button>

                                    </div>
                                </div>
                            </div>
                            <hr class="my-1" />
                            <div class="row">
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Date from:</label>
                                        <input type="date" class="form-control focus" id="modal_edit_guest_details_date_from">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Date until:</label>
                                        <input type="date" class="form-control focus" id="modal_edit_guest_details_date_until">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Option</label>
                                        <input type="text" class="form-control focus" id="modal_edit_guest_details_option">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">First name</label>
                                        <input type="text" class="form-control focus" id="modal_edit_guest_details_first_name">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Last name</label>
                                        <input type="text" class="form-control focus" id="modal_edit_guest_details_last_name">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Gender</label>
                                        <div class="d-flex flex-wrap mt-1">
                                            <div class="custom_radio radio_lg mr-4">
                                                <label for="modal_edit_guest_details_sex_type_M">
                                                    Male
                                                    <input type="radio" id="modal_edit_guest_details_sex_type_M" checked="checked" name="add_guest_details_sex_radio">
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="custom_radio radio_lg">
                                                <label for="modal_edit_guest_details_sex_type_F">
                                                    Female
                                                    <input type="radio" id="modal_edit_guest_details_sex_type_F" name="add_guest_details_sex_radio">
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Type of document</label>
                                        <div id="modal_edit_guest_details_select_type_of_document" class="select">
                                            <button class="custom-select focus" id="modal_edit_guest_details_type_of_document_btn"></button>
                                            <i class="fas fa-angle-down"></i>
                                            <ul class="select_ul hidden" id="modal_edit_guest_details_type_of_document_ul">
                                                <li class="select_li" data-id="002"> Osobna putovnica (strana) </li>
                                                <li class="select_li" data-id="027"> Osobna iskaznica (strana) </li>
                                                <li class="select_li" data-id="032"> Vozačka dozvola (strana) </li>
                                                <li class="select_li" data-id="051"> Osobna iskaznica (domaća) </li>
                                                <li class="select_li" data-id="028"> Osobna putovnica (domaća) </li>
                                                <li class="select_li" data-id="999"> Zdrastvena iskaznica </li>
                                                <li class="select_li" data-id="037"> Službena putovnica (domaća) </li>
                                                <li class="select_li" data-id="033"> Dječja putovnica (domaća) </li>
                                                <li class="select_li" data-id="103"> Vozačka dozvola (domaća) </li>
                                                <li class="select_li" data-id="004"> Zajednička putovnica (strana) </li>
                                                <li class="select_li" data-id="003"> Obiteljska putovnica (strana) </li>
                                                <li class="select_li" data-id="005"> Dječja putovnica (strana) </li>
                                                <li class="select_li" data-id="006"> Diplomatska putovnica (strana) </li>
                                                <li class="select_li" data-id="007"> Službena putovnica (strana) </li>
                                                <li class="select_li" data-id="008"> Pomorska knjižica (strana) </li>
                                                <li class="select_li" data-id="009"> Brodarska knjižica (strana) </li>
                                                <li class="select_li" data-id="011"> Putni list za strance - izdan od RH </li>
                                                <li class="select_li" data-id="012"> Putna isprava za izbjeglice </li>
                                                <li class="select_li" data-id="013"> Putna isprava za osobe bez državljanstva </li>
                                                <li class="select_li" data-id="022"> Potvrda o oduzimanju ili zadržavanju putne isprave </li>
                                                <li class="select_li" data-id="023"> Potvrda o prijavi gubitka ili nestanka putne isprave </li>
                                                <li class="select_li" data-id="024"> Osobna iskaznica za stranca - izdana od RH </li>
                                                <li class="select_li" data-id="025"> Posebna osobna iskaznica - diplomatska konzularna službena </li>
                                                <li class="select_li" data-id="026"> Isprave izdane na temelju međ. ugovora </li>
                                                <li class="select_li" data-id="029"> Pogranična propusnica (strana) </li>
                                                <li class="select_li" data-id="030"> Izbjeglički karton izdan od RH </li>
                                                <li class="select_li" data-id="034"> Putni list za strance (strani) </li>
                                                <li class="select_li" data-id="039"> Ostalo </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-3">
                                    <div class="form-group">
                                        <label class="mb-1">Document number</label>
                                        <input type="text" class="form-control focus" id="modal_edit_guest_details_document_number">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-3">
                                    <div class="form-group">
                                        <label class="mb-1">Expiration date</label>
                                        <input type="date" class="form-control focus" id="modal_edit_guest_details_expiration_date">
                                    </div>
                                </div>

                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Citizenship</label>
                                        <div id="modal_edit_guest_details_select_country_citizenship" class="select">

                                            <div id="modal_edit_dropdown_example_country_search_citizenship" class="light_dropdown icon search">
                                                <div class="light_dropdown-btn light_dropdown-toggle">
                                                    <input type="text" class="light_dropdown-input bg-white" id="modal_edit_guest_details_country_citizenship" data-value="hr" />
                                                    <div class="light_dropdown-box">
                                                        Search country
                                                    </div>
                                                </div>
                                                <ul class="light_dropdown-menu hidden" id="modal_edit_guest_details_countries_ul_citizenship">
                                                    <!-- Only text no country -->
                                                    <li class="no_result hidden" data-value="">Not found</li>
                                                </ul>
                                            </div>

                                        </div>
                                        <!--<div id="modal_edit_guest_details_select_citizenship" class="select">
                                        <button class="custom-select focus" id="modal_edit_guest_details_select_citizenship_btn"></button>
                                        <i class="fas fa-angle-down"></i>
                                        <ul class="select_ul hidden" id="modal_edit_guest_details_select_citizenship_ul">-->
                                        <!--<li class="select_li" data-id="1"><span><img src="./assets/images/icons/flags/ad.svg" alt=""></span>Example</li>
                                        <li class="select_li" data-id="2"><span><img src="./assets/images/icons/flags/at.svg" alt=""></span>Austria</li>
                                        <li class="select_li" data-id="3">
                                            <span><img src="./assets/images/icons/flags/es.svg" alt=""></span>Spain
                                        </li>
                                        <li class="select_li" data-id="4"><span><img src="./assets/images/icons/flags/fi.svg" alt=""></span>Finska</li>
                                        <li class="select_li" data-id="5"><span><img src="./assets/images/icons/flags/fr.svg" alt=""></span>France</li>
                                        <li class="select_li" data-id="6"><span><img src="./assets/images/icons/flags/hr.svg" alt=""></span>Croatia</li>-->
                                        <!--</ul>
                                        </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">City</label>
                                        <input type="text" class="form-control focus" id="modal_edit_guest_details_city">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Country</label>
                                        <div id="modal_edit_guest_details_select_country" class="select">

                                            <div id="modal_edit_dropdown_example_country_search" class="light_dropdown icon search">
                                                <div class="light_dropdown-btn light_dropdown-toggle">
                                                    <input type="text" class="light_dropdown-input bg-white" id="modal_edit_guest_details_country" data-value="hr" />
                                                    <div class="light_dropdown-box">
                                                        Search country
                                                    </div>
                                                </div>
                                                <ul class="light_dropdown-menu hidden" id="modal_edit_guest_details_countries_ul">
                                                    <!-- Only text no country -->
                                                    <li class="no_result hidden" data-value="">Not found</li>
                                                </ul>
                                            </div>

                                        </div>

                                        <!--<div id="modal_edit_guest_details_select_country" class="select">
                                        <button class="custom-select focus" id="modal_edit_guest_details_country" data-code1=""></button>
                                        <i class="fas fa-angle-down"></i>
                                        <ul class="select_ul hidden" id="modal_edit_guest_details_countries_ul">-->
                                        <!--adding countries via template-->
                                        <!--</ul>
                                        </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Place of residence</label>
                                        <input type="text" class="form-control focus" value="" id="modal_edit_guest_details_place_of_residence">
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Country of residence</label>
                                        <div id="modal_edit_guest_details_select_country_residence" class="select">

                                            <div id="modal_edit_dropdown_example_country_search_residence" class="light_dropdown icon search">
                                                <div class="light_dropdown-btn light_dropdown-toggle">
                                                    <input type="text" class="light_dropdown-input bg-white" id="modal_edit_guest_details_country_residence" data-value="hr" />
                                                    <div class="light_dropdown-box">
                                                        Search country
                                                    </div>
                                                </div>
                                                <ul class="light_dropdown-menu hidden" id="modal_edit_guest_details_countries_ul_residence">
                                                    <!-- Only text no country -->
                                                    <li class="no_result hidden" data-value="">Not found</li>
                                                </ul>
                                            </div>

                                        </div>
                                        <!--<div id="modal_edit_guest_details_select_country_of_birth" class="select">
                                            <button class="custom-select focus" id="modal_edit_guest_details_select_country_btn" data-code1=""></button>
                                            <i class="fas fa-angle-down"></i>
                                            <ul class="select_ul hidden" id="modal_edit_guest_details_select_country_of_residence_ul">
                                                <li class="select_li" data-id="1"><span><img src="./assets/images/icons/flags/ad.svg" alt=""></span>Example</li>
                                                <li class="select_li" data-id="2"><span><img src="./assets/images/icons/flags/at.svg" alt=""></span>Austria</li>
                                                <li class="select_li" data-id="3">
                                                    <span><img src="./assets/images/icons/flags/es.svg" alt=""></span>Spain
                                                </li>
                                                <li class="select_li" data-id="4"><span><img src="./assets/images/icons/flags/fi.svg" alt=""></span>Finska</li>
                                                <li class="select_li" data-id="5"><span><img src="./assets/images/icons/flags/fr.svg" alt=""></span>France</li>
                                                <li class="select_li" data-id="6"><span><img src="./assets/images/icons/flags/hr.svg" alt=""></span>Croatia</li>
                                            </ul>
                                        </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="form-group">
                                        <label class="mb-1">Date birth</label>
                                        <input type="date" class="form-control focus" id="modal_edit_guest_details_date_birth">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="mb-1">Description</label>
                                        <textarea name="description" id="modal_edit_guest_details_note" class="form-control focus" cols="30" rows="5"></textarea>
                                    </div>
                                </div>

                                <!-- evisitor -->
                                <div class="add_inside_evisitor col-12">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="checkbox">
                                                    <div class="d-flex align-items-center user_select_none">
                                                        <input type="checkbox" id="modal_rent_details_city_tax">
                                                        <div class="check check_md"></div>
                                                        <div class="pl-2">City tax</div>
                                                    </div>
                                                </label>
                                                <label class="checkbox">
                                                    <div class="d-flex align-items-center user_select_none">
                                                        <input type="checkbox" id="modal_rent_details_guest_visible_on_invoice">
                                                        <div class="check check_md"></div>
                                                        <div class="pl-2">Guest visible on invoice</div>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6"></div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="mb-1">Arrival organization</label>
                                                <div id="modal_edit_guest_details_select_arrival_organization" class="select">
                                                    <button class="custom-select focus" id="modal_edit_guest_details_select_arrival_organization_btn"></button>
                                                    <i class="fas fa-angle-down"></i>
                                                    <ul class="select_ul hidden" id="modal_edit_guest_details_select_arrival_organization_ul">
                                                        <!--<li class="select_li" data-id="1">Agencijski (Grupno)</li>
                                                        <li class="select_li" data-id="2">Osobno</li>
                                                        <li class="select_li" data-id="3">Agencijski - (60 dana odgode)</li>-->
                                                        <li class="select_li" data-id="I">Osobno</li>
                                                        <li class="select_li" data-id="A">Agencijski (grupa)</li>

                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-8">
                                            <div class="form-group">
                                                <label class="mb-1">Category obv.bp</label>
                                                <div id="modal_edit_guest_details_select_category" class="select">
                                                    <button class="custom-select focus" id="modal_edit_guest_details_category"></button>
                                                    <i class="fas fa-angle-down"></i>
                                                    <ul class="select_ul hidden" id="modal_edit_guest_details_category_ul">
                                                        <!--<li class="select_li" data-id="1">Osobe do 29 godina : članovi međunarodne omladinske organizacije</li>
                                                        <li class="select_li" data-id="2">Đaci koji nemaju prebivalište u općini ili gradu u kojem se školuju</li>
                                                        <li class="select_li" data-id="3">Turist koji boravi u ugostiteljskom objektu</li>
                                                        <li class="select_li" data-id="4">Djeca : od navršenih 12-18 godina</li>
                                                        <li class="select_li" data-id="5">Turist koji koristi usluge chartera</li>
                                                        <li class="select_li" data-id="6">Pratitelj osobe sa tjelesnim invaliditetom 70% i više</li>
                                                        <li class="select_li" data-id="7">Sudionici školskih paket aranžmana odobrenih od strane školske ustanove</li>
                                                        <li class="select_li" data-id="8">Vlasnici kuće za odmor i članovi njegove obitelji</li>
                                                        <li class="select_li" data-id="9">Osobe koje uslugu noćenja koriste u okviru ostvarivanja programa socijalne skrbi</li>
                                                        <li class="select_li" data-id="9">Prijatelji i ostale osobe koje borave u stanu ili kući stanovnika općine ili grada</li>
                                                        <li class="select_li" data-id="9">Prijatelji i ostale osobe vlasnika kuće ili stana za odmor</li>
                                                        <li class="select_li" data-id="9">Član posade na brodu</li>
                                                        <li class="select_li" data-id="9">Putnik na brodu</li>
                                                        <li class="select_li" data-id="9">Kapetan broda</li>
                                                        <li class="select_li" data-id="9">Djeca do 12 godina : charter</li>
                                                        <li class="select_li" data-id="9">Djeca od navršenih 12-18 godina : charter</li>-->

                                                        <li class="select_li" data-id="14">N - Turist koji boravi u ugostiteljskom objektu</li>
                                                        <li class="select_li" data-id="13">N - Turist koji koristi usluge chartera</li>
                                                        <li class="select_li" data-id="2">J - Djeca : od navršenih 12-18 godina</li>
                                                        <li class="select_li" data-id="5">N - Osobe do 29 godina : članovi međunarodne omladinske organizacije</li>
                                                        <li class="select_li" data-id="3">J - Djeca od navršenih 12-18 godina : charter</li>
                                                        <li class="select_li" data-id="1">A - Djeca : do 12 godina</li>
                                                        <li class="select_li" data-id="7">B - Osobe sa tjelesnim invaliditetom 70% i više</li>
                                                        <li class="select_li" data-id="8">B - Pratitelj osobe sa tjelesnim invaliditetom 70% i više</li>
                                                        <li class="select_li" data-id="12">C - Sudionici školskih paket aranžmana odobrenih od strane školske ustanove</li>
                                                        <li class="select_li" data-id="10">G - Sezonski radnici</li>
                                                        <li class="select_li" data-id="11">N - Studenti</li>
                                                        <li class="select_li" data-id="4">J - Đaci</li>
                                                        <li class="select_li" data-id="9">H - Putnici na putničkom brodu u međunarodnom pomorskom prometu kada se brod nalazi na vezu u luci</li>
                                                        <li class="select_li" data-id="6">L - Osobe koje koriste uslugu noćenja u svom mjestu prebivališta</li>
                                                        <li class="select_li" data-id="Nepoznato">N - Vlasnici kuće za odmor i članovi njegove obitelji</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer justify-content-between">
                            <div class="d-flex m-0">
                                <button class="btn btn_silver ml-0 m-1" data-dismiss="modal">Close</button>
                                <button class="btn btn_secondary m-1" onclick="document.querySelector('#modal_body_guests_list_tab').click(); modal_details_rent.bl.clear_edit_guest();">Back</button>

                            </div>
                            <button class="btn btn_secondary mr-0 m-1 " onclick="modal_details_rent.bl.edit_guest();"><i class="fas fa-plus pr-2"></i>Save</button>
                        </div>
                    </div>

                    <!-- options -->
                    <div id="modal_body_option" class="tab-pane modal_tabs_option">
                        <div class="modal-body">
                            <div class="font_6 font_bold pb-2"><i class="far fa-calendar-plus pr-2"></i>Options</div>
                            <div class="d-flex align-items-center pt-2">
                                <div class="pr-2">Options is active until</div>
                                <div class="position-relative">
                                    <input id="modal_datepicker_input_details_option" type="text"
                                           class="form-control focus modal_datepicker_input_option"
                                           style="max-width: 8rem">
                                    <span id="modal_datepicker_details_option" class="modal_datepicker_option"></span>
                                    <span id="modal_input_details_close" class="modal_input_close">
                                        <i class="fas fa-times"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="pt-2">Remaining days: 0</div>
                        </div>
                        <div class="modal-footer">
                            <div class="text-right">
                                <button type="button" class="btn btn_secondary" data-dismiss="modal">
                                    <i class="fas fa-save pr-2"></i>Save
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- payments add -->
                    <div id="modal_body_add_payment" class="tab-pane add_payment">
                        <div class="modal-body pb-0">
                            <div class="font_6 font_bold pb-2"><i class="fas fa-money-bill-alt pr-2"></i>Payment</div>
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Price</th>
                                        <th>Exchange rate</th>
                                    </tr>
                                </thead>
                                <tbody id="modal_rent_details_payment_recive_tbody">
                                    <tr>
                                        <td>1.1.2021</td>
                                        <td><span class="type font_2 text-uppercase px-2 py-1">Cash</span></td>
                                        <td>600 EUR</td>
                                        <td>7,45</td>
                                    </tr>
                                    <tr>
                                        <td>1.1.2021</td>
                                        <td><span class="type font_2 text-uppercase px-2 py-1">Cash</span></td>
                                        <td>600 EUR</td>
                                        <td>7,45</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer d-flex justify-content-between">
                            <a class="btn btn_silver"><i class="fas fa-edit pr-2"></i>Edit</a>
                            <button type="button" class="btn btn_secondary" data-dismiss="modal">
                                <i class="fas fa-save pr-2"></i>Save
                            </button>
                        </div>
                    </div>

                    <!-- key -->
                    <div id="modal_body_add_key" class="tab-pane add_key">
                        <div class="modal-body pb-0">
                            <div class="font_6 font_bold pb-2"><i class="fas fa-key pr-2"></i>Smart door</div>
                            <div class="overflow-auto">
                                <table class="table mb-0 modal_smartdoor">
                                    <thead>
                                        <tr>
                                            <th scope="col">Name</th>
                                            <th scope="col">Pin</th>
                                            <th scope="col">From</th>
                                            <th scope="col">Until</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modal_rent_details_doors_tbody">
                                        <tr>
                                            <td>Door 01</td>
                                            <td>
                                                <span><input type="text" pattern="\d*" maxlength="8" class="inside_input text-center" value="4583" style="width: 6rem;" /></span><span class="px-1 smartdoor_icon" data-toggle="tooltip" data-placement="top" data-original-title="General"><i class="fas fa-retweet"></i></span><span class="px-1 smartdoor_icon" data-toggle="tooltip" data-placement="top" data-original-title="Save"><i class="fab fa-keycdn"></i></span>
                                            </td>
                                            <td>19.01.2021 @ 9h</td>
                                            <td>21.01.2021 @ 10h</td>
                                        </tr>
                                        <tr>
                                            <td>Door 02</td>
                                            <td>
                                                <span><input type="text" pattern="\d*" maxlength="8" class="inside_input text-center" value="4583" style="width: 6rem;" /></span><span class="px-1 smartdoor_icon" data-toggle="tooltip" data-placement="top" data-original-title="General"><i class="fas fa-retweet"></i></span><span class="px-1 smartdoor_icon" data-toggle="tooltip" data-placement="top" data-original-title="Save"><i class="fab fa-keycdn"></i></span>
                                            </td>
                                            <td>19.01.2021 @ 9h</td>
                                            <td>21.01.2021 @ 10h</td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                        <div class="modal-footer d-flex justify-content-end">
                            <button type="button" class="btn btn_secondary" data-dismiss="modal">
                                <i class="fas fa-save pr-2"></i>Save
                            </button>
                        </div>
                    </div>

                    <!-- chat -->
                    <div id="modal_body_chat" class="tab-pane chat">
                        <div class="modal-body">
                            <div class="font_6 font_bold pb-2"><i class="far fa-comments pr-2"></i>Chat</div>
                            <div class="chat_box px-3" id="modal_rent_details_chat">
                            </div>
                            <hr />
                            <div class="chat_new_message">
                                <textarea class="form-control focus" id="model_rent_details_chatbox" onkeyup="modal_details_rent.ui.success();"></textarea>
                                <button class="btn btn_secondary d-block ml-auto mt-2" id="model_chatbox_btn_send" onclick="modal_details_rent.bl.chat_messages()" disabled><i class="fas fa-paper-plane pr-2"></i>Send</button>
                            </div>
                        </div>
                    </div>

                    <!-- payments -->
                    <div id="modal_body_payments" class="tab-pane payments">
                        <div class="modal-body">
                            <div class="font_6 font_bold pb-2"><i class="far fa-comments pr-2"></i>Payments</div>
                            <div>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Price</th>
                                            <th>Currency</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modal_rent_details_payment_list">

                                        <template>
                                            <tr>
                                                <td>${ js.date.toIso(r['payment_date_until'])}</td>
                                                <td>${ r['price'] }</td>
                                                <td>${ r['currency_code'] }</td>
                                                <td>${ r['status'] || "Unpaid" }</td>
                                            </tr>
                                        </template>

                                        <template>
                                            <tr>
                                                <td> - </td>
                                                <td> - </td>
                                                <td> - </td>
                                                <td> - </td>
                                            </tr>
                                        </template>

                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>

    </div>

</div>

<!-- modals -->
<div>

    <!-- Modal add new rent item -->
    <div id="modal_add_new_rent_item" class="modal_add_new_rent_item"></div>

</div>

<!-- templates -->
<section>

    <!--template for rent status list-->
    <template id="template_rent_status_li">

        <li class="dropdown_li" data-id="${rent_status_id}" data-name="${name}">
            <div class="d-flex align-items-center">
                <div class="icon" style="background-color: ${color};"></div>
                <div class="name align-self-center">${name}</div>
            </div>
        </li>

    </template>

    <!--template for rent sources list-->
    <template id="template_rent_sources_li">

        <li class="dropdown_li" data-id="${apartment_rent_source_id}" data-name="${icon}">
            <div class="d-flex align-items-center">
                <div class="icon icon_img">
                    <img src="./assets/images/icons/portals/${img}.svg" alt="">
                </div>
                <div class="name align-self-center">${name}</div>
            </div>
        </li>

    </template>

    <!--template for payment methods list-->
    <template id="template_payment_methods_li">

        <li class="dropdown_li" data-id="${payment_method_id}" data-name="${name}" onclick="select_drop">
            <div class="d-flex align-items-center">
                <!--<div class="icon"><i class="fas fa-piggy-bank"></i></div>-->
                <div class="name align-self-center">${name}</div>
            </div>
        </li>
    </template>

    <!--template for list of objects-->
    <template id="template_object_list_li">
        <li class="dropdown_li" data-id="${id}">${name}</li>
    </template>

    <!--template for list of countries-->
    <template id="template_countries_list_li">

        <li class="dropdown_li" data-id="${id}" data-name="${country}">
            <div class="d-flex align-items-center">
                <span class="flag pr-2">
                    <img src="./assets/images/icons/flags/${code2}.svg"
                         alt="">
                </span>
                <span>${country}</span>
            </div>
        </li>

    </template>

    <!--template for countries list in adding guest-->
    <template id="template_countries_list_add_guest">
        <li class="light_dropdown-item select_li" data-id="${id}" data-code1="${code1}">
            <span class="light_dropdown-icon">
                <img src="./assets/images/icons/flags/${code2}.svg" alt="">
            </span>

            <div class="light_dropdown-label">${country}</div>
        </li>
    </template>

    <!--template for invoices for one rent-->
    <template id="template_invoices_tr">

        <tr class="tr-bill">
            <td>${date}</td>
            <td class="red" style="cursor: pointer;">
                <span class="font_6" onclick="modal_details_rent.bl.print_bills(this);" data-guid="${guid}"><i class="fas fa-file-pdf"></i></span>
            </td>
            <td>${label}</td>
            <td>
                <a href='/#bills_edit?${invoice_id}' onclick="modal_rent_details_close_modal.click();">${type}</a>
            </td>
            <td>${price}</td>
            <td class="text-right">
                <label onclick="modal_details_rent.ui.tr_success(this)"
                       class="checkbox">
                    <input type="checkbox" checked>
                    <span class="check check_xl"></span>
                </label>
            </td>
        </tr>

    </template>

    <!--template for doors lock-->
    <!--<template id="template_rent_doors_locks">

        <tr>
            <td>${username}</td>
            <td>
                <span><input type="text" pattern="\d*" maxlength="8" class="inside_input text-center" value="${pin}" style="width: 6rem;" /></span><span class="px-1 smartdoor_icon" data-toggle="tooltip" data-placement="top" data-original-title="General"><i class="fas fa-retweet"></i></span><span class="px-1 smartdoor_icon" data-toggle="tooltip" data-placement="top" data-original-title="Save"><i class="fab fa-keycdn"></i></span>
            </td>
            <td>${start_date}</td>
            <td>${end_date}</td>
        </tr>

    </template>-->
    <!--template for chat messages that are recived-->
    <template id="template_messages_recive">

        <div class="receive my-2 mr-5">
            <div class="receive_text">${text}</div>
            <div class="receive_date pl-2">${date} ${time}</div>
        </div>

    </template>

    <!--template for chat massages that are send-->
    <template id="template_messages_send">
        <div class="send ml-5">
            <div class="send_text">${text}</div>
            <div class="d-flex justify-content-end">
                <div class="event text-success"><i class="${seen}"></i></div>
                <div class="send_date text-right pl-2 pr-1">${date} ${time}</div>
            </div>
        </div>
    </template>

    <!--template for email log-->
    <template id="template_log_email">
        <tr>
            <td>${subject}</td>
            <td>${created}</td>
            <td>${time}</td>
            <td class="text-right text-success"><i class="${email_status}"></i></td>
        </tr>
    </template>

    <!--template for payment recived-->
    <template id="template_payment_recive">

        <tr>
            <td>${created}</td>
            <td><span class="type font_2 text-uppercase px-2 py-1">${payment_method_type}</span></td>
            <td>${price} ${currency_code}</td>
            <td>7,45</td>
        </tr>

    </template>

    <!--template for list of price days-->
    <template id="template_list_per_day">

        <div class="py-1 pl-2 pt-2 pb-2">
            <div class="text-center" style="font-size:smaller">${day}</div>
            <div class="form-group m-0">
                <input type="text" class="form-control focus text-center" value="${price}" data-id="${id}" data-date="${day}"
                       style="max-width: 6rem; width: 6rem;" onchange="modal_details_rent.bl.price_change_day();">

            </div>
        </div>
    </template>

    <!--template for items list-->
    <template id="template_items_list">
        <li class="select_li" data-id="${id}" data-name="${name}">${name}</li>
    </template>

    <!--template for new row of item-->
    <template id="template_items_new_row">
        <tr id="modal_rent_details_tr_${id}" data-id="${id}">

            <td style="min-width: 13rem;" class="px-0 border-top-0 pb-0">
                <div>
                    <input type="text" class="form-control focus" value="" id="modal_rent_details_service_${id}" onchange="modal_details_rent.bl.change_items_total_price('${id}');" />
                </div>
            </td>
            <td class="pr-0 border-top-0 pb-0">
                <div class="form-group m-0 input_remove_number_arrow">
                    <input type="number" class="form-control focus text-center pr-5" id="modal_rent_details_item_price_${id}" onchange="modal_details_rent.bl.change_items_total_price('${id}');">
                    <span class="value font_2 opacity_50" id="modal_rent_details_item_value_label_${id}">${currency_name}</span>
                </div>
            </td>
            <td class="pr-0 border-top-0 pb-0">
                <div class="form-group m-0 input_remove_number_arrow">
                    <input type="number" class="form-control focus text-center" id="modal_rent_details_item_amount_${id}" onchange="modal_details_rent.bl.change_items_total_price('${id}');">
                </div>
            </td>
            <td class="pr-0 border-top-0 pb-0">
                <div class="form-group m-0 input_remove_number_arrow">
                    <input type="number" class="form-control focus pr-4 text-center" id="modal_rent_details_item_tax_${id}" onchange="modal_details_rent.bl.change_items_total_price('${id}');">
                    <span class="value font_2"><i class="fas fa-percent"></i></span>
                </div>
            </td>
            <td class="border-top-0">
                <div class="form-group m-0">
                    <input type="text" class="form-control pr-5" readonly disabled id="modal_rent_details_item_total_${id}">
                    <span class="value font_2">${currency_name}</span>
                </div>
            </td>

            <td scope="row" class="trash text-center border-top-0"><i class="fas fa-trash-alt red fa-lg" onclick="modal_details_rent.bl.delete_row(`modal_rent_details_tr_${id}`, `${id}`); modal_details_rent.bl.total_item_price();"></i></td>
        </tr>
    </template>

    <!--template for list of guest-->
    <template id="template_guests_list">
        <tr class="tr-bill" data-id="${id}" id="modal_rent_details_guest_${i}">

            <td style="max-width: 2rem;">
                <img src="./assets/images/icons/flags/${code2}.svg" height="20" alt="">
            </td>
            <td onclick="modal_details_rent.ui.load_selected_guest(this.parentElement)">${name_first} ${name_last}</td>
            <td onclick="modal_details_rent.ui.load_selected_guest(this.parentElement)">${years}</td>
            <td onclick="modal_details_rent.ui.load_selected_guest(this.parentElement)">${days} days</td>
            <td onclick="modal_details_rent.ui.load_selected_guest(this.parentElement)">${price} €</td>

            <td class="text-right">
                <!--onclick="modal_details_rent.ui.tr_success(this)"-->
                <label class="checkbox p-0">
                    <input type="checkbox" ${checked}>
                    <span class="check check_xl"></span>
                </label>
            </td>

            <td class="text-center" onclick="modal_details_rent.bl.delete_guest(this.parentElement);">
                <i class="fas fa-trash-alt red fa-lg"></i>
            </td>
        </tr>
    </template>

    <!--template for showing existing guests in add guest tab-->
    <template id="template_existing_guest">

        <div class="p-2 btn_hover cursor_point" onclick="modal_details_rent.ui.load_existing_guest(`${id}`);">
            <div>
                <img src="./assets/images/icons/flags/${code2}.svg" height="15" alt="">
                <span class="font_3">${name_first} ${name_last}</span>
            </div>
            <div>
                <span class="font_3">Doc. No. </span>
                <span class="border-left mx-2 border-dark"></span>
                <span class="font_3">${document_number}</span>
            </div>
        </div>
        <hr class="my-2" />
    </template>
</section>

<!-- scripts -->
<script>

    //debugger;

    var modal_details_rent = {};

    modal_details_rent.rent_id = '';
    modal_details_rent.object_id = '';
    modal_details_rent.item_id = '';
    modal_details_rent.calendar_book_dates = [];
    modal_details_rent.items_number = 0;
    modal_details_rent.flag = 0;
    modal_details_rent.guest_id = '';
    modal_details_rent.currency_label = '';
    modal_details_rent.days = '';
    modal_details_rent.currency_id = '';
    modal_details_rent.exchange = '';

    // dates selected on calendar
    modal_details_rent.calendar_date_from = '';
    modal_details_rent.calendar_date_until = '';

    // dates of rents
    modal_details_rent.date_from = '';
    modal_details_rent.date_until = '';

    // loading
    modal_details_rent.load = async () => {

        // Load modal add new rent item
        await $(".modal_add_new_rent_item").load("/pages/rents/modal_rent_add_item.html");

        // Global ui
        // TODO: adjust to new version
        //modal_details_rent.ui.select_custom("modal_rent_details_select_curr");

        modal_details_rent.ui.load_currency();
        modal_details_rent.ui.load_rent_sources();
        modal_details_rent.ui.load_payment_methods();
        await modal_details_rent.ui.load_rent_status();
        // TODO: adjust to new version
        modal_details_rent.ui.load_object_list();
        modal_details_rent.ui.load_countries_list();

        //modal_details_rent.ui.load_items_list();
        modal_details_rent.ui.load_guest_countries();

        //modal_details_rent.ui.load_rent_doors_locks();
        modal_details_rent.ui.init_modal_steps();

        ui.dropdown_list("modal_rent_details_object");
        ui.dropdown_list("modal_rent_details_custom_status");
        ui.dropdown_list("modal_rent_details_paid");
        ui.dropdown_list("modal_filter_country");

        ui.custom_select("modal_rent_details_currency_dropdown");
        //ui.dropdown_list("modal_filter_object");
        modal_details_rent.ui.select_on_mobile();


        // Local ui
        modal_details_rent.ui.tr_current_success("modal_body_bills");
        modal_details_rent.ui.filter_search_list("modal_filter_country");
        //modal_details_rent.ui.filter_search_list("modal_filter_object");
        //modal_details_rent.ui.filter_available();
        modal_details_rent.ui.modal_close("modal_rent_details");
        //modal_details_rent.ui.select_custom('modal_rent_details_service');

        //modal_details_rent.ui.calendar_dropdown();

        modal_details_rent.ui.calendar_dropdown('#modal_rent_details_calendar_btn', '#modal_rent_details_calendar', 2, '#modal_rent_details_calendar_check_in', '#modal_rent_details_calendar_check_out', 'td-highlight', 'td-highlight-hover');

        // for edit guest tab
        ui.custom_select("modal_edit_guest_details_select_country");
        ui.custom_select("modal_edit_guest_details_select_country_citizenship");
        ui.custom_select("modal_edit_guest_details_select_country_residence");

        ui.custom_select("modal_edit_guest_details_select_type_of_document");
        ui.custom_select("modal_edit_guest_details_select_arrival_organization");
        //ui.custom_select("modal_edit_guest_details_select_type_of_service");
        ui.custom_select("modal_edit_guest_details_select_category");

        // for add guest tab
        ui.custom_select("modal_add_guest_details_select_country");
        ui.custom_select("modal_add_guest_details_select_type_of_document");
        ui.custom_select("modal_add_guest_details_select_country_citizenship");
        ui.custom_select("modal_add_guest_details_select_country_residence");
        ui.custom_select("select_curr_modal");
        //ui.custom_select("modal_add_guest_details_select_type_of_service");
        //ui.custom_select("modal_add_guest_details_select_category");

        modal_details_rent.bl.only_dropdown("modal_mail_send");
        modal_details_rent.bl.only_dropdown("modal_mail_send_offer");
        modal_details_rent.bl.only_dropdown("modal_mail_send_voucher");



        modal_details_rent.bl.toggle_dropdown("modal_rent_details_guests");

        modal_details_rent.bl.icon_portal_dropdown("modal_rent_details_icon_portal_dropdown");

        //Initializing dropdown countries list for Adding
        light.dropdown.init('#modal_add_dropdown_example_country_search');
        light.dropdown.init('#modal_add_dropdown_example_country_search_residence');
        light.dropdown.init('#modal_add_dropdown_example_country_search_citizenship');

        //Initializing dropdown countries list for Editing
        light.dropdown.init('#modal_edit_dropdown_example_country_search');
        light.dropdown.init('#modal_edit_dropdown_example_country_search_residence');
        light.dropdown.init('#modal_edit_dropdown_example_country_search_citizenship');


        ui.dropdown_list("modal_rent_details_cancelation_policy");

        modal_details_rent.bl.toggle_dropdown_calendar("modal_rent_details_calendar_dropdown");

    }

    modal_details_rent.ui = new function () {

        //this.select_custom = function (id) {

        //    let select_id = document.getElementById(id);
        //    let btn = select_id.getElementsByTagName("button")[0];
        //    let ul = select_id.getElementsByTagName("ul")[0];
        //    let li = select_id.getElementsByTagName("li")[0];
        //    btn.onclick = function () {
        //        if (!btn.classList.contains("open")) {
        //            btn.classList.add("open");
        //            ul.classList.remove("hidden");
        //            let ulOffset = $(ul).offset();
        //            let spaceUp = (ulOffset.top - $(btn).height() - $(ul).height()) - $(window).scrollTop();
        //            let spaceDown = $(window).scrollTop() + $(window).height() - (ulOffset.top + $(ul).height());
        //            if (spaceDown < 0 && (spaceUp >= 0 || spaceUp > spaceDown)) {
        //                ul.classList.add("reverse");
        //            } else {
        //                ul.classList.remove("reverse");
        //            }
        //        } else {
        //            btn.classList.remove("open");
        //            ul.classList.add("hidden");
        //        }
        //    };
        //    document.addEventListener("mouseup", function (e) {
        //        if (!$(btn).is(e.target) && $(ul).has(e.target).length === 0) {
        //            if (!$(ul).is(e.target) && $(ul).has(e.target).length === 0) {
        //                ul.classList.add("hidden");
        //                btn.classList.remove("open");
        //            }
        //        }
        //    });
        //    for (let i = 0; i < ul.children.length; i++) {
        //        ul.children[i].onclick = function (e) {
        //            btn.innerHTML = e.currentTarget.innerHTML;
        //            ul.classList.add("hidden");
        //            btn.classList.remove("open");
        //        }
        //    }

        //    for (let i = 0; i < ul.children.length; i++) {
        //        const element = ul.children[i];

        //        element.onclick = function (e) {

        //            btn.innerHTML = e.currentTarget.innerHTML;
        //            if (id == 'modal_new_rent_select_countries') {

        //                document.querySelector('#' + id).dataset.id = e.currentTarget.dataset.id;
        //            } else {
        //                document.querySelector('#' + id).dataset.name = e.currentTarget.innerText;
        //                document.querySelector('#' + id).dataset.id = e.currentTarget.dataset.id;

        //            }


        //            ul.classList.add("hidden");
        //            //button.classList.remove("open");
        //        }
        //    }
        //}


        //this.check_input_city_field_on_change(){

        //    let inputHtmlElement = document.getElementById("modal_add_guest_details_city");

        //    let value = inputHtmlElement.value;

        //    if (value) {

        //    }

        //}

        // Calendar dropdown
        this.calendar_dropdown = function (form_calendar, cal, numberOfMonths, input_from, input_until, hightlight_hover, class_highlight_hover) {

            $(cal).datepicker({
                firstDay: 1,
                //minDate: 0,
                numberOfMonths: numberOfMonths,
                dateFormat: 'dd.mm.yy.',

                beforeShowDay: function (date) {

                    var startDate = $.datepicker.parseDate($(cal).datepicker('option', 'dateFormat'), $(input_from).val());
                    var endDate = $.datepicker.parseDate($(cal).datepicker('option', 'dateFormat'), $(input_until).val());

                    var className = "";

                    if (startDate && (date.getTime() == startDate.getTime())) {
                        className = "start-date td-highlight"
                    }
                    else if (endDate && (date.getTime() == endDate.getTime())) {
                        className = "end-date td-highlight";
                    }
                    else if ((startDate && endDate) && (startDate < date && date < endDate)) {
                        className = "between-date td-highlight";
                    }
                    else {
                        className = "";
                    }
                    return [true, className];
                },

                onSelect: function (dateText, inst) {

                    var startDate = $.datepicker.parseDate($(cal).datepicker('option', 'dateFormat'), $(input_from).val());
                    var endDate = $.datepicker.parseDate($(cal).datepicker('option', 'dateFormat'), $(input_until).val());
                    var selectedDate = $.datepicker.parseDate($(cal).datepicker('option', 'dateFormat'), dateText);

                    if (!startDate || endDate) {
                        //console.log(dateText);

                        $(input_from).val(dateText).text(dateText);
                        $(input_until).val("");
                        $(input_until).text("--");
                        $(this).datepicker();
                    }
                    else if (selectedDate < startDate) {
                        $(input_until).val($(input_from).val());
                        $(input_from).val(dateText);
                        $(this).datepicker();
                    }
                    else {
                        //debugger;
                        var until_date = js.date.toIso(selectedDate);
                        var from_date = js.date.toIso(startDate);


                        modal_rent_details_calendar_check_in.dataset.day = from_date;
                        modal_rent_details_calendar_check_out.dataset.day = until_date;

                        $(input_until).val(dateText).text(dateText);
                        $(this).datepicker();
                        document.getElementById("modal_rent_details_calendar_btn").classList.remove("open");
                        document.getElementById("modal_rent_details_calendar").classList.add("hidden");
                    }
                }
            });

            var debounce;
            $(window).resize(function () {
                clearTimeout(debounce);
                if ($(window).width() < 670) {
                    debounce = setTimeout(function () {
                        debounceDatepicker(1);
                    }, 200);
                } else {
                    debounce = setTimeout(function () {
                        debounceDatepicker(numberOfMonths)
                    }, 200);
                }
            }).trigger('resize');

            function debounceDatepicker(no) {
                $(cal).datepicker("option", "numberOfMonths", no);
            }

            $(cal).on('mouseenter', 'td a', function () {
                $("." + class_highlight_hover).removeClass(class_highlight_hover); // Reset
                isBetween = false;
                foundFirst = 0;
                calendar_datepicker = $(this).closest('.ui-datepicker');
                if (calendar_datepicker.find('.start-date').length > 0 && calendar_datepicker.find('.end-date').length == 0) {
                    calendar_datepicker.find(".ui-state-default").each(function () {
                        if ($(this).hasClass("ui-state-active")) {
                            if (foundFirst == 0) foundFirst = -1;
                            isBetween = (foundFirst == -1 ? true : false);
                        }
                        if ($(this).hasClass("ui-state-hover")) {
                            if (foundFirst == 0) foundFirst = 1;
                            isBetween = (foundFirst == 1 ? true : false);
                        }
                        if (isBetween) {
                            $(this).parent().addClass(class_highlight_hover);
                        }
                    });
                }
            })

        }

        this.input_focus = function () {
            document.getElementById('modal_rent_details_country_input').focus();
        }

        // Tr current success
        this.tr_current_success = function (id) {
            let table_id = document.getElementById(id);
            let checkboxes = table_id.querySelector("input[type='checkbox']");
            let tr = table_id.querySelectorAll(".tr-bill");
            for (let i = 0; i < tr.length; i++) {
                var checkbox = tr[i].querySelector("input[type='checkbox']");
                if (checkbox.checked == true) {
                    tr[i].classList.add("bg_success_shadow");
                } else {
                    tr[i].classList.remove("bg_success_shadow");
                }
            }
        }

        this.fp_calendar = null;

        // Modal calendar
        // WARNING: NOT USED ANYMORE
        this.modal_details_calendar = function () {

            // modal_details_calendar

            modal_details_rent.ui.fp_calendar = flatpickr("#modal_details_calendar", {
                mode: "range",
                dateFormat: "Y-m-d",
                //disable: [
                //    {
                //        from: modal_rent_details_rent_date_from.innerHTML,
                //        to: modal_rent_details_rent_date_until.innerHTML
                //    }],

                inline: true,


                onChange: function (selectedDates, dateStr, instance) {

                    if (!modal_details_rent.calendar_date_from == false && !modal_details_rent.until_date == false) {


                        var date_iso = js.date.toIso(selectedDates[0]);

                        modal_details_rent.calendar_date_from = date_iso;
                        modal_rent_details_rent_date_from.innerHTML = date_iso;
                        modal_details_rent.until_date = '';
                    }
                    else {

                        //var date = new Intl.DateTimeFormat('en-GB').format(selectedDates[0]);

                        //var date = selectedDates[0].getDate() + '.' + (selectedDates[0].getMonth() + 1) + '.' + selectedDates[0].getFullYear().toString().substr(-2);
                        var date_iso = js.date.toIso(selectedDates[0]);
                        modal_rent_details_rent_date_from.innerHTML = date_iso;


                        if (!selectedDates[1] == false) {

                            //var date = new Intl.DateTimeFormat('en-GB').format(selectedDates[1]);

                            // var date = selectedDates[1].getDate() + '.' + (selectedDates[0].getMonth() + 1) + '.' + selectedDates[1].getFullYear().toString().substr(-2);
                            var date_iso = js.date.toIso(selectedDates[1]);
                            modal_details_rent.until_date = date_iso;
                            modal_rent_details_rent_date_until.innerHTML = date_iso;
                            document.querySelector('.modal_dropdown_menu_calendar').classList.add('hidden');

                        }

                    }
                },

            });

            flatpickr("#modal_edit_guest_details_date_from", {
                dateFormat: "Y-m-d",
                allowInput: true

            });

            // instance for date until
            flatpickr("#modal_edit_guest_details_date_until", {
                dateFormat: "Y-m-d",
                allowInput: true
            });

            // instance for date of birth
            flatpickr("#modal_edit_guest_details_date_birth", {
                dateFormat: "Y-m-d",
                allowInput: true
            });

            flatpickr("#modal_add_guest_details_date_from", {
                dateFormat: "Y-m-d",
                allowInput: true

            });

            // instance for date until
            flatpickr("#modal_add_guest_details_date_until", {
                dateFormat: "Y-m-d",
                allowInput: true
            });

            // instance for date of birth in add guest tab
            flatpickr("#modal_add_guest_details_date_birth", {
                dateFormat: "Y-m-d",
                allowInput: true,
                onChange: function (selectedDates, dateStr, instance) {
                    console.log(selectedDates);
                    console.log(dateStr);
                    console.log(instance);
                }
            });

        }

        //set calendar
        this.calendar_set = async function () {

            var url = 'https://api.zaggy.net/objects/days_blocked/' + modal_details_rent.object_id;
            modal_details_rent.calendar_book_dates = await $.getJSON(url).promise();

            $(modal_rent_details_calendar).datepicker;

        }

        // Custom select of dropdown menus
        this.select_custom = function (id) {
            let select_id = document.getElementById(id);
            let btn = select_id.getElementsByTagName("button")[0];
            let ul = select_id.getElementsByTagName("ul")[0];
            let li = select_id.getElementsByTagName("li")[0];

            btn.onclick = function () {
                if (!btn.classList.contains("open")) {
                    btn.classList.add("open");
                    ul.classList.remove("hidden");
                    let ulOffset = $(ul).offset();
                    let spaceUp = (ulOffset.top - $(btn).height() - $(ul).height()) - $(window).scrollTop();
                    let spaceDown = $(window).scrollTop() + $(window).height() - (ulOffset.top + $(ul).height());
                    if (spaceDown < 0 && (spaceUp >= 0 || spaceUp > spaceDown)) {
                        ul.classList.add("reverse");
                    } else {
                        ul.classList.remove("reverse");
                    }
                } else {
                    btn.classList.remove("open");
                    ul.classList.add("hidden");
                }
            };

            document.addEventListener("mouseup", function (e) {
                if (!$(btn).is(e.target) && $(ul).has(e.target).length === 0) {
                    if (!$(ul).is(e.target) && $(ul).has(e.target).length === 0) {
                        ul.classList.add("hidden");
                        btn.classList.remove("open");
                    }
                }
            });

            for (let i = 0; i < ul.children.length; i++) {
                ul.children[i].onclick = function (e) {
                    btn.innerHTML = e.currentTarget.innerHTML;
                    ul.classList.add("hidden");
                    btn.classList.remove("open");
                }
            }
        }

        // Modal date option
        this.datepicker_input = function (id, input, remove) {

            let input_date = document.getElementById(input);
            let remove_date = document.getElementById(remove);

            input_date.addEventListener("focus", function () {
                $("#" + id).fadeIn(100);
                $("#" + input).addClass("open");
            });

            $(function () {
                $("#" + id).datepicker({
                    onSelect: function (dateText, inst) {
                        $("#" + input).val(dateText);
                        $("#" + id).fadeOut(100);
                        $("#" + input).removeClass("open");
                    }
                });
            });

            $(document).mouseup(function (e) {
                if (!$("#" + input).is(e.target) && $("#" + input).has(e.target).length === 0) {
                    $("#" + id).fadeOut(100);
                }
            });

            remove_date.onclick = function () {
                $("#" + input).val("");
            }
        }

        // Modal details open calendar
        this.modal_details_show_calendar = function (id) {

            let btn = document.querySelector("." + id);
            let dropdown = btn.getElementsByClassName("modal_dropdown_menu_calendar")[0];

            btn.addEventListener("click", function () {
                if (!btn.classList.contains("open")) {
                    btn.classList.add("open");
                    dropdown.classList.remove("hidden");
                }
            });

            document.addEventListener("mouseup", function (e) {
                if (!$(dropdown).is(e.target) && $(dropdown).has(e.target).length === 0) {
                    dropdown.classList.add("hidden");
                    btn.classList.remove("open");
                }
            });
        }

        // Modal details check paid
        this.modal_details_paid = function (id) {
            let check = document.getElementById(id);
            let btn = check.getElementsByClassName("checkbox")[0];
            let check_box = check.querySelector("input[type='checkbox']");
            btn.onclick = function () {
                if (check_box.checked == true) {
                    btn.classList.add("bg_success_shadow");
                } else {
                    btn.classList.remove("bg_success_shadow");
                }
            };
        }

        // Modal details - filter for search country
        this.filter_search_list = function (id) {
            let filter_id = document.getElementById(id);
            let li = filter_id.querySelectorAll(".dropdown_li");
            let input = filter_id.getElementsByClassName("form-control")[0];
            document.addEventListener("keyup", function () {
                filter = input.value.toUpperCase();
                for (let i = 0; i < li.length; i++) {
                    let list = li[i].children[0].lastElementChild;
                    textValue = list.textContent || list.innerText;
                    if (textValue.toUpperCase().indexOf(filter) > -1) {
                        li[i].style.display = "";
                    } else {
                        li[i].style.display = "none";
                    }
                }
            })
        }

        // Object available - all || Free || Taken
        this.filter_available = function () {
            let filter_id = document.getElementById("modal_filter_object");
            let all_btn = filter_id.getElementsByClassName("btn_all")[0];
            let free_btn = filter_id.getElementsByClassName("btn_free")[0];
            let taken_btn = filter_id.getElementsByClassName("btn_taken")[0];
            let dropdown_li = filter_id.querySelectorAll(".dropdown_li");
            all_btn.onclick = function () {
                for (let i = 0; i < dropdown_li.length; i++) {
                    dropdown_li[i].classList.remove("hidden");
                }
            }
            free_btn.addEventListener("click", function () {
                for (let i = 0; i < dropdown_li.length; i++) {
                    dropdown_li[i].classList.remove("hidden");
                    if (!dropdown_li[i].classList.contains("free")) {
                        dropdown_li[i].classList.add("hidden");
                    }
                }
            })
            taken_btn.addEventListener("click", function () {
                for (let i = 0; i < dropdown_li.length; i++) {
                    dropdown_li[i].classList.remove("hidden");
                    if (!dropdown_li[i].classList.contains("taken")) {
                        dropdown_li[i].classList.add("hidden");
                    }
                }
            })
        }

        // Tr checkbox click success
        this.tr_success = function (e) {
            var tr_bg = e.parentElement.parentElement;
            if (e.children[0].checked == true) {
                tr_bg.classList.add("bg_success_shadow");
            } else {
                tr_bg.classList.remove("bg_success_shadow");
            }
        }

        // Modal - open details
        this.show_details = async function (rent_id) {

            let modal_id = document.querySelector(".modal_rent_details");

            if (modal_id.classList.contains('hidden')) {

                //show modal
                modal_id.classList.remove('hidden');
                modal_id.classList.remove('visuallyhidden');

                if (rent_id) {
                    await modal_details_rent.bl.load_data(rent_id);

                    if (window.location.href.includes("messages")) {
                        modal_details_rent_chat_tab_href.click();
                    }
                }

                //setTimeout(function () {
                //    modal_id.classList.remove('visuallyhidden');

                //    // load data
                //    if(rent_id) {
                //        modal_details_rent.bl.load_data(rent_id);
                //    }

                //}, 20);
            }
            else {
                modal_id.classList.add('visuallyhidden');
                modal_id.addEventListener('transitionend', function (e) {
                    modal_id.classList.add('hidden');
                }, {
                    capture: false,
                    once: true,
                    passive: false
                });
            }
        }

        // Modal - close details
        this.modal_close = function (id) {

            let details_id = document.querySelector('.modal_rent_details');
            let modal_content = details_id.getElementsByClassName("modal_content")[0];
            let dismiss = details_id.querySelectorAll("[data-dismiss='modal']");

            for (let i = 0; i < dismiss.length; i++) {
                dismiss[i].onclick = function () {
                    hide_modal();
                }
            }

            //document.addEventListener("mouseup", function (e) {
            //    if (!$(modal_content).is(e.target) && $(modal_content).has(e.target).length === 0) {
            //        if (!details_id.classList.contains("hidden")) {
            //            hide_modal();
            //        };
            //    };
            //});


            //closing modal on esc key
            //document.addEventListener('keydown', (event) => {
            //    if (event.key === 'Escape') {
            //        hide_modal();
            //    }
            //})

            // save rent on CTRL + S
            $(window).keydown(function (event) {

                var page = location.hash.slice(1);
                page = page.split('?')[0];
                if (page == 'calendar' || page == 'rents') {
                    if (!(event.which == 83 && event.ctrlKey)) return true;

                    modal_details_rent.bl.save_rent();
                    alert('Rezervacija uspiješno spremljena');
                    event.preventDefault();
                    return false;
                }

            });

            function hide_modal() {

                details_id.classList.add('visuallyhidden');
                details_id.addEventListener('transitionend', function (e) {
                    details_id.classList.add('hidden');
                }, {
                    capture: false,
                    once: true,
                    passive: false
                });

                // clearing payment method
                var el = document.getElementById('modal_rent_details_paid');
                el.dataset.id = '';
                el.querySelector(".dropdown_name").innerHTML = "-";

                // clearing rent status
                var el = document.getElementById('modal_rent_details_custom_status');
                el.dataset.id = '';
                el.querySelector(".dropdown_name").innerHTML = '-';

                // clearing rent source
                var el = document.getElementById('modal_rent_details_icon_portal_dropdown');
                el.dataset.id = '';
                el.querySelector(".modal_rent_id").innerHTML = '&nbsp;';

                // clearing country of person
                var el = document.getElementById('modal_filter_country');
                el.dataset.id = '';
                el.querySelector(".dropdown_name").innerHTML = '-';

                // Reset icon after modal close
                setTimeout(function () {
                    modal_rent_details_image.src = './assets/images/icons/portals/circle.svg';

                }, 200);

            }

        }

        // Load countries into dropdown menu
        this.load_guest_countries = function () {

            var countries = bl.countries.list();

            //Editing
            modal_edit_guest_details_countries_ul.innerHTML = '';
            modal_edit_guest_details_countries_ul_residence.innerHTML = '';
            modal_edit_guest_details_countries_ul_citizenship.innerHTML = '';

            //Adding
            modal_add_guest_details_countries_ul.innerHTML = '';
            modal_add_guest_details_countries_ul_residence.innerHTML = '';
            modal_add_guest_details_countries_ul_citizenship.innerHTML = '';

            for (var c of countries) {

                var t = template_countries_list_add_guest.innerHTML;

                t = t.replace('${id}', c['id']);
                t = t.replace('${code1}', c['code1']);
                t = t.replace('${code2}', c['code2']);
                t = t.replace('${country}', c['country']);

                //Editing
                js.html.insertAdjacentHTML('modal_edit_guest_details_countries_ul', t);
                js.html.insertAdjacentHTML('modal_edit_guest_details_countries_ul_residence', t);
                js.html.insertAdjacentHTML('modal_edit_guest_details_countries_ul_citizenship', t);

                //Adding
                js.html.insertAdjacentHTML('modal_add_guest_details_countries_ul', t);
                js.html.insertAdjacentHTML('modal_add_guest_details_countries_ul_residence', t);
                js.html.insertAdjacentHTML('modal_add_guest_details_countries_ul_citizenship', t);
            }
        }

        this.init_modal_steps = function () {
            // .step_toggle" data-step="4"
            // .modal_step_02

            let togglers = document.querySelectorAll('.step_toggle');
            let steps = document.querySelectorAll('.modal_step_01, .modal_step_02, .modal_step_03, .modal_step_04');

            togglers.forEach((toggler, idx) => {

                // .bg_secondary .bg_silver03
                toggler.onclick = function () {

                    steps.forEach(s => s.classList.add('hidden'));
                    togglers.forEach((t_inner, idx_inner) => {

                        let circle = t_inner.querySelector('.bg_secondary, .bg_silver03');
                        if (idx_inner <= idx) {
                            circle.classList.replace('bg_silver03', 'bg_secondary');
                        }
                        else {
                            circle.classList.replace('bg_secondary', 'bg_silver03');
                        }
                    });
                    steps[idx].classList.remove('hidden');
                }


            });
        }

        // load rent status
        this.load_rent_status = function () {

            var status = bl.rents_status.list();
            modal_rent_details_rent_status.innerHTML = '';

            for (var s of status) {
                var t = template_rent_status_li.innerHTML;
                t = t.replace('${rent_status_id}', s['id']);
                t = t.replace('${color}', s['color']);
                t = t.replace('${name}', s['name']);
                t = t.replace('${name}', s['name']);
                js.html.insertAdjacentHTML('modal_rent_details_rent_status', t);
            }
        }

        // load rent sources
        this.load_rent_sources = function () {

            var sources = bl.rents_sources.list().filter(el => el['name'] && el['icon']);
            //modal_rent_details_rent_source_dropdown = '';

            for (var s of sources) {
                var t = template_rent_sources_li.innerHTML;
                t = t.replace('${apartment_rent_source_id}', s['id']);
                t = t.replace('${img}', s['icon']);
                t = t.replace('${icon}', s['icon']);
                t = t.replaceAll('${name}', s['name']);
                js.html.insertAdjacentHTML('modal_rent_details_rent_source_dropdown', t);
            }

        }

        this.load_currency = function () {

            var currencies = bl.currency.list();

            var ul = modal_rent_details_currency_dropdown.getElementsByTagName('ul')[0];
            ul.innerHTML = '';


            for (var c of currencies) {
                var t = '<li class="select_li" data-id="${id}">${code}</li>';
                t = t.replace('${id}', c['id']);
                t = t.replace('${code}', c['code']);
                ul.insertAdjacentHTML('beforeend', t);
            }

        }

        // load payment methods
        this.load_payment_methods = function () {

            var payment_methods = bl.payment_methods.list();
            modal_rent_details_payment_method_type = '';


            for (var pm of payment_methods) {

                var t = template_payment_methods_li.innerHTML;

                t = t.replace('${payment_method_id}', pm['id']);
                t = t.replaceAll('${name}', pm['name']);

                js.html.insertAdjacentHTML('modal_rent_details_payment_method_type', t);
            }

        }

        // loading object list
        this.load_object_list = function () {

            var object_list = bl.objects.list_get();
            modal_rent_details_objects_list.innerHTML = '';

            for (var ol of object_list) {
                var t = template_object_list_li.innerHTML;
                t = t.replace('${id}', ol['id']);
                t = t.replace('${name}', ol['name']);
                js.html.insertAdjacentHTML('modal_rent_details_objects_list', t);

            }
        }

        // loading countries into dropdown menu
        this.load_countries_list = function () {

            //debugger;

            var countries_list = bl.countries.list();

            modal_rent_details_countries_list = '';

            for (var cl of countries_list) {
                var t = template_countries_list_li.innerHTML;

                t = t.replace('${country}', cl['country']);
                t = t.replace('${code2}', cl['code2']);
                t = t.replace('${id}', cl['id']);
                t = t.replace('${country}', cl['country']);

                js.html.insertAdjacentHTML('modal_rent_details_countries_list', t);
            }

        }

        // load days and price for every day
        this.load_prices_per_day = async function () {

            var url = '/api/rents_prices_days/list_day/' + modal_details_rent.rent_id;

            var response = await ajax.get(url);
            var response_json = JSON.parse(response);
            if (response_json.length == 0) {
                modal_details_rent.bl.generate_price_day();
                response = await ajax.get(url);
                response_json = JSON.parse(response);
            }

            //modal_rent_details_list_per_day.innerHTML = '';

            for (var ppd of response_json) {
                var day = ppd['day'].split('T')[0];
                var t = template_list_per_day.innerHTML;
                t = t.replace('${id}', ppd['id']);
                t = t.replace('${day}', day.split('-')[2] + '.' + day.split('-')[1]);
                t = t.replace('${day}', ppd['day'].split('T')[0]);
                t = t.replace('${price}', ppd['price'].toFixed([2]));
                //js.html.insertAdjacentHTML('modal_rent_details_list_per_day', t);

            }
        }

        // load list on invoices for one rent
        this.load_invoices_list = async function () {

            ui.content_loading("modal_rent_details_content_loading");

            modal_rent_details_invoices_tbody.innerHTML = '';
            var invoices_list_string = await bl.invoices.list_by_rent(modal_details_rent.rent_id);
            var invoices_list = JSON.parse(invoices_list_string);

            for (var il of invoices_list) {

                var t = template_invoices_tr.innerHTML;

                t = t.replaceAll('${date}', il['inv_date'].split('T')[0]);
                t = t.replaceAll('${label}', il['number_code'] === null ? '-' : il['number_code']);
                t = t.replaceAll('${type}', il['type']);
                t = t.replaceAll('${invoice_id}', il['id']);
                t = t.replaceAll('${guid}', il['guid']);
                t = t.replaceAll('${price}', il['price'].toFixed([2]));

                js.html.insertAdjacentHTML('modal_rent_details_invoices_tbody', t);

            }

            ui.content_loading_hide("modal_rent_details_content_loading");

        }

        // loading messages into template
        this.load_messages = async function () {

            modal_rent_details_chat.innerHTML = '';
            var message_list_string = await bl.messages.conversation_messages(modal_details_rent.rent_id);
            var message_list = await JSON.parse(message_list_string);

            if (Number(modal_new_messages.innerText) > 0) {

                // Mark message as seen
                modal_new_messages.classList.add('hidden');
                var url = '/api/messages/message_seen_not_user/' + modal_details_rent.rent_id;
                await ajax.get_json(url);

                // Refresh notifications for new messages and new rents
                header_navbar_right_shrotcuts.bl.set_notifications();

                // Remove number of new messages on rent list
                if (window.location.href.includes("messages")) {
                    var message_rent_id = document.getElementById('message_rent_' + modal_details_rent.rent_id);
                    message_rent_id.innerText = '-';
                }
            }

            var total = message_list.length - 1;

            for (var i = total; i > -1; i--) {

                if (message_list[i]['creator'] == 'user') {
                    var t = template_messages_send.innerHTML;
                }
                else {
                    var t = template_messages_recive.innerHTML;
                }

                t = t.replace('${date}', message_list[i]['created'].split('T')[0]);
                t = t.replace('${time}', message_list[i]['created'].split('T')[1]);
                t = t.replace('${text}', message_list[i]['message']);
                t = t.replace('${seen}', message_list[i]['seen'] == 'Y' ? 'fas fa-circle fa-xs' : '');
                js.html.insertAdjacentHTML('modal_rent_details_chat', t);
            }

        }

        this.load_number_of_new_messages = async () => {

            var count_new_messages = '';

            if (window.location.href.includes('messages')) {
                count_new_messages = Number(document.getElementById('message_rent_' + modal_details_rent.rent_id).innerText);
            }
            else {
                var url = '/api/messages/new_messages_count_not_user/' + modal_details_rent.rent_id;
                count_new_messages = await ajax.get_json(url);
            }

            if (count_new_messages > 0) {
                modal_new_messages.innerText = count_new_messages;
                modal_new_messages.classList.remove('hidden');
            } else {
                modal_new_messages.classList.add('hidden');
            }

        }

        // loading emails for one rent
        this.load_emails = async function () {

            modal_body_messages_tbody_id.innerHTML = '';
            var emails_list_string = await bl.email.list_of_emails(modal_details_rent.rent_id);
            var emails_list = JSON.parse(emails_list_string);

            for (var el of emails_list) {

                var t = template_log_email.innerHTML;

                t = t.replace('${subject}', el['subject']);
                t = t.replace('${created}', el['created'].split('T')[0]);
                t = t.replace('${time}', el['created'].split('T')[1]);
                t = t.replace('${email_status}', el['email_status'] == 'ok' ? 'fas fa-check' : 'fas fa-times');
                js.html.insertAdjacentHTML('modal_body_messages_tbody_id', t);

            }

        }

        // loading payment that are recived for rent
        this.load_payment_recive = async function () {

            modal_rent_details_payment_recive_tbody.innerHTML = '';
            var payment_recive_string = await bl.payment_recive.list_of_payment_recive(modal_details_rent.rent_id);
            var payment_recive = JSON.parse(payment_recive_string);

            for (var pr of payment_recive) {
                var t = template_payment_recive.innerHTML;

                t = t.replace('${created}', pr['created'].split('T')[0]);
                t = t.replace('${payment_method_type}', pr['payment_method_type']);
                t = t.replace('${price}', pr['price'].toFixed([2]));
                t = t.replace('${currency_code}', pr['currency_code']);

                js.html.insertAdjacentHTML('modal_rent_details_payment_recive_tbody', t);

            }

        }

        // hiding modal
        this.hide_modal = () => {
            document.getElementsByClassName('modal_rent_details')[0].classList.add('hidden');

            modal_new_messages.innerText = '';

        }

        // showing hidden menu of prices per day
        this.show_prices_per_day = function () {
            //modal_rent_details_list_per_day
            //if (modal_rent_details_list_per_day.classList.contains('hidden')) {
            //    modal_rent_details_list_per_day.classList.remove('hidden');
            //} else {
            //    modal_rent_details_list_per_day.classList.add('hidden');
            //}
        }

        // Load items into dropdown list
        this.load_items_list = function () {

            modal_rent_details_item_list.innerHTML = '';
            //var element_id = id;
            var items_list = bl.item.get();

            for (var il of items_list) {

                var t = template_items_list.innerHTML;
                t = t.replace('${name}', il['name']);
                t = t.replace('${name}', il['name']);
                t = t.replace('${id}', il['id']);

                js.html.insertAdjacentHTML('modal_rent_details_item_list', t);
            }

        }

        // insert new row of items
        this.insert_items_row = function (id) {

            var t = template_items_new_row.innerHTML;
            t = t.replace('${div_number}', modal_details_rent.items_number);
            t = t.replace('${ul_number}', modal_details_rent.items_number);
            t = t.replaceAll('${number}', modal_details_rent.items_number);
            t = t.replaceAll('${id}', id);
            t = t.replaceAll('${currency_name}', modal_details_rent.currency_label);
            js.html.insertAdjacentHTML('modal_rent_details_tbody', t);

            if (modal_details_rent.flag == 0) {
                document.getElementById('modal_rent_details_service_' + modal_details_rent.items_number).value = document.querySelector('#modal_rent_details_service > button').innerText;
                document.getElementById('modal_rent_details_item_price_' + modal_details_rent.items_number).value = modal_rent_details_item_price.value.toFixed(2);
                document.getElementById('modal_rent_details_item_amount_' + modal_details_rent.items_number).value = modal_rent_details_item_amount.value;
                document.getElementById('modal_rent_details_item_tax_' + modal_details_rent.items_number).value = modal_rent_details_item_tax.value;
                //document.getElementById('modal_rent_details_item_total_' + modal_details_rent.items_number).value = modal_rent_details_item_total.value;

                // clearing row for adding after items is add
                document.querySelector('#modal_rent_details_service > button').innerText = 'Choose item';
                modal_rent_details_item_price.value = '';
                modal_rent_details_item_amount.value = '';
                modal_rent_details_item_tax.value = '';
                modal_rent_details_item_total.value = '';
            }

            modal_details_rent.items_number++;

            //modal_details_rent.bl.total_item_price();
            //modal_details_rent.bl.calculate_total_items_prices();
            modal_details_rent.ui.extra_item_currency_display(modal_details_rent.currency_label);
        }

        //change currency in extra items
        this.extra_item_currency_display = (curr) => {

            /*debugger;

            for (var i = 0; i < modal_details_rent.items_number; i++) {

                let id = "modal_rent_details_item_value_label_" + i;
                let elem = document.getElementById(id);
                elem.innerText = curr;
                elem.innerText = curr;

            }*/

        }

        // loading guest into list of selected rent
        this.load_guests = async () => {

            //show spinner
            ui.content_loading("modal_rent_details_content_loading");

            var url = '/api/guests/list_guest_by_rent_id/' + modal_details_rent.rent_id;
            var countries = bl.countries.list();
            var guests_list = await ajax.get(url);
            var guests_list_json = JSON.parse(guests_list);
            modal_rent_details_guest_tbody.innerHTML = '';

            for (var gl of guests_list_json) {
                var t = template_guests_list.innerHTML;
                //for (var c of countries) {
                //    if (gl['residence_country'] == null) {
                //        t = t.replace('${code2}', '');
                //    }
                //    if (c['code1'] == gl['residence_country'].toUpperCase()) {
                //        t = t.replace('${code2}', c['code2']);
                //    }
                //}
                t = t.replace('${id}', gl['id']);
                t = t.replace('${i}', gl['id']);
                t = t.replace('${name_last}', gl['name_last']);
                t = t.replace('${name_first}', gl['name_first']);
                t = t.replace('${price}', gl['price_sum_local'].toFixed([2]));
                t = t.replace('${code2}', gl['country_code']);
                t = t.replace('${days}', gl['days'] == null ? '-' : gl['days']);
                t = t.replace('${years}', gl['years'] == null ? '-' : gl['years']);
                t = t.replace('${checked}', gl['sync'] == 'Y' ? 'checked' : '');
                js.html.insertAdjacentHTML('modal_rent_details_guest_tbody', t);
            }

            //hide spinner
            ui.content_loading_hide("modal_rent_details_content_loading");
        }

        // loading guest that selected from list of guests to editing form
        this.load_selected_guest = async function (elem) {

            ui.content_loading("modal_rent_details_content_loading");

            modal_details_rent.guest_id = elem.dataset.id;
            elem.id = "modal_rent_details_guest_" + elem.dataset.id;

            var url = '/api/guests/get_guest_by_guest_id/' + elem.dataset.id;
            var response_string = await ajax.get(url);
            var response = JSON.parse(response_string)[0];
            document.querySelector('#modal_body_edit_guest_tab').click();

            console.log("GUEST", response);
            response['checkin'] == 'Y' ? modal_rent_details_evisitor_icon.classList.remove('hidden') : '';

            // guest
            modal_edit_guest_details_first_name.value = response['name_first'];
            modal_edit_guest_details_last_name.value = response['name_last'];
            modal_rent_details_guest_visible_on_invoice.checked = response['visible_on_invoice'] == 'Y' ? true : false;
            modal_rent_details_city_tax.checked = response['city_tax'] == 'Y' ? true : false;
            modal_edit_guest_details_date_from.value = response['date_from'].split('T')[0];
            modal_edit_guest_details_date_until.value = response['date_until'].split('T')[0];
            modal_edit_guest_details_note.value = response['note'];
            modal_edit_guest_details_sex_type_M.checked = response['gender'] == 'muški' ? true : false;
            modal_edit_guest_details_sex_type_F.checked = response['gender'] == 'ženski' ? true : false;

            // guest evisitor
            if (response['birth_date']) {
                modal_edit_guest_details_date_birth.value = response['birth_date'].split('T')[0];
            }


            modal_edit_guest_details_country.dataset.code1;
            modal_edit_guest_details_city.value = response['birth_city'];
            modal_edit_guest_details_document_number.value = response['document_number'];
            modal_edit_guest_details_place_of_residence.value = response['residence_city'];

            if (response['country_code_iso'] != null && response['country_code_iso'] != '') {
                document.querySelector(`#modal_edit_guest_details_countries_ul > li[data-code1=${response['country_code_iso']}]`).click();
            }
            if (response['citizenship'] != null && response['citizenship'] != '') {
                document.querySelector(`#modal_edit_guest_details_countries_ul_citizenship > li[data-code1=${response['citizenship'].toUpperCase()}]`).click();
            }
            if (response['residence_country'] != null && response['residence_country'] != '') {
                document.querySelector(`#modal_edit_guest_details_countries_ul_residence > li[data-code1=${response['residence_country'].toUpperCase()}]`).click();
            }
            if (response['document_type'] != null && response['document_type'] != '') {
                document.querySelector(`#modal_edit_guest_details_type_of_document_ul > li[data-id="${response['document_type']}"]`).click();
            }
            if (response['arrival_organisation'] != null && response['arrival_organisation'] != '') {
                document.querySelector(`#modal_edit_guest_details_select_arrival_organization_ul  > li[data-id="${response['arrival_organisation']}"]`).click();
            }
            if (response['tt_payment_category'] != null && response['tt_payment_category'] != '') {
                document.querySelector(`#modal_edit_guest_details_category_ul > li[data-id="${response['tt_payment_category']}"]`).click();
            }

            ui.content_loading_hide("modal_rent_details_content_loading");

        }

        // search for first 10 exisiting guests
        this.search_first_10 = async function () {

            var guest = {};
            guest.id = bl.workers.current_user_id();
            guest.name_first = modal_add_guest_details_first_name.value;
            guest.name_last = modal_add_guest_details_last_name.value;
            guest.document_number = modal_add_guest_details_document_number.value;

            var url = '/api/guests/search_limit_10_json/';

            var response = await ajax.post_json(url, guest);
            var response_json = JSON.parse(response);

            //debugger;

            var countries = bl.countries.list();
            modal_rent_details_existing_guest_div.innerHTML = '';
            for (var gl of response_json) {
                var t = template_existing_guest.innerHTML;
                for (var c of countries) {
                    if (gl['residence_country'] == null) {
                        t = t.replace('${code2}', '');
                    } else if (c['code1'] == gl['residence_country'].toUpperCase()) {
                        t = t.replace('${code2}', c['code2']);
                    }
                }
                t = t.replace('${document_number}', gl['document_number']);
                t = t.replace('${name_last}', gl['name_last']);
                t = t.replace('${name_first}', gl['name_first']);
                t = t.replace('${id}', gl['id']);

                js.html.insertAdjacentHTML('modal_rent_details_existing_guest_div', t);
            }
        }

        // loading existing guest to add guest form
        this.load_existing_guest = async function (id) {

            var url = '/api/guests/get_guest_by_guest_id/' + id;

            var response = await ajax.get(url);
            var response_json = JSON.parse(response)[0];

            modal_add_guest_details_first_name.value = response_json['name_first'];
            modal_add_guest_details_last_name.value = response_json['name_last'];
            modal_add_guest_details_date_from.value = response_json['date_from'].split('T')[0];
            modal_add_guest_details_date_until.value = response_json['date_until'].split('T')[0];
            modal_add_guest_details_city.value = response_json['birth_city'];
            modal_add_guest_details_date_birth.value = response_json['birth_date'];
            modal_add_guest_details_document_number.value = response_json['document_number'];
            modal_add_guest_details_place_of_residence.value = response_json['residence_city'];
            modal_add_guest_details_sex_type_M.checked = response_json['gender'] == 'muški' ? true : false;
            modal_add_guest_details_sex_type_F.checked = response_json['gender'] == 'ženski' ? true : false;

            if (response_json['country_code_iso'] != null && response_json['country_code_iso'] != '') {
                document.querySelector(`#modal_add_guest_details_countries_ul > li[data-code1=${response_json['country_code_iso']}]`).click();
            }
            if (response_json['citizenship'] != null && response_json['citizenship'] != '') {
                document.querySelector(`#modal_add_guest_details_countries_ul_citizenship > li[data-code1=${response_json['citizenship'].toUpperCase()}]`).click();
            }
            if (response_json['residence_country'] != null && response_json['residence_country'] != '') {
                document.querySelector(`#modal_add_guest_details_countries_ul_residence > li[data-code1=${response_json['residence_country'].toUpperCase()}]`).click();
            }
            if (response_json['document_type'] != null && response_json['document_type'] != '') {
                document.querySelector(`#modal_add_guest_details_type_of_document_ul > li[data-id="${response_json['document_type']}"]`);
            }


        }

        this.select_on_mobile = () => {

            modal_rent_details_items_table.classList.add('mobile_overflow_select');
            modal_rent_details_items_table.classList.add('pb_16_mobile');
        }

        this.success = () => {
            if (model_rent_details_chatbox.value == '') {
                model_chatbox_btn_send.disabled = true;
            } else {
                model_chatbox_btn_send.disabled = false;
            }
        }
    }

    // Logic BL
    modal_details_rent.bl = new function () {

        // Loading data for one rent modal_rent_details_advance_percent
        this.load_data = async (rent_id) => {
            //show load
            document.getElementsByClassName('tab-content')[0].style.visibility = 'hidden';
            await ui.content_loading('modal_rent_details_content_loading');

            // on open modal selecting home tab
            document.querySelectorAll('.modal_ul > li > a')[0].click()

            modal_details_rent.rent_id = rent_id;

            // Load number of unread messages
            modal_details_rent.ui.load_number_of_new_messages();

            bl.workers.current_rent_id(rent_id);

            // setup url for mails preview
            modal_rent_details_confirmation_preview.href = '/rents/email/' + modal_details_rent.rent_id;
            modal_rent_details_voucher_preview.href = 'rents/email_voucher/' + modal_details_rent.rent_id;
            modal_rent_details_offer_preview.href = 'rents/email_offer/' + modal_details_rent.rent_id;

            var url = '/api/rents/get/' + modal_details_rent.rent_id;

            var response = await ajax.get(url);
            var data = JSON.parse(response);

            guest_portal_btn.href = 'https://rent.zaggy.net/' + data[0]['guid'];
            guest_portal_link.href = 'https://rent.zaggy.net/' + data[0]['guid'];

            // setting up global currency
            modal_details_rent.currency_id = data[0]['currency_id'];
            modal_details_rent.exchange = data[0]['exchange'];

            //set data for displaying in details modal

            try {

                modal_rent_details_objects_list.querySelector('[data-id="' + data[0]['object_id'] + '"]').click();

            } catch (error) {

                console.log();
            }


            let from = data[0]['from_date'].split('T')[0];
            let until = data[0]['until_date'].split('T')[0];

            var adults = data[0]['rent_adults'];
            var children = data[0]['rent_children'];
            var pets = data[0]['rent_pets'];

            modal_rent_details_calendar_check_in.dataset.day = from;
            modal_rent_details_calendar_check_out.dataset.day = until;

            modal_details_rent.item_id = data[0]['item_id'];

            modal_rent_details_rent_id.innerHTML = data[0]['id'];
            modal_details_rent.object_id = data[0]['object_id'];

            if (data[0]['rent_source_icon']) {
                modal_rent_details_image.src = "./assets/images/icons/portals/" + data[0]['rent_source_icon'] + ".svg";
                modal_rent_details_rent_source_dropdown.dataset.id = data[0]['rent_source_id'];
            } else {
                modal_rent_details_image.src = "./assets/images/icons/portals/syncbeds.svg";
                modal_rent_details_rent_source_dropdown.dataset.id = null;
            }

            //modal_rent_details_rent_source_dropdown.dataset.id = data[0]['rent_source_id'];

            modal_rent_details_contact_name.value = data[0]['contact_name'];
            modal_rent_details_contact_email.value = data[0]['contact_email'];
            modal_rent_details_contact_tel.value = data[0]['contact_tel'];

            modal_rent_details_guests_adults.children[0].innerText = adults;
            modal_rent_details_guests_children.children[0].innerText = children;
            modal_rent_details_guests_pets.children[0].innerText = pets;

            modal_details_rent.bl.input_counter("modal_rent_details_adults", adults, "modal_rent_details_guests_adults");
            modal_details_rent.bl.input_counter("modal_rent_details_children", children, "modal_rent_details_guests_children");
            modal_details_rent.bl.input_counter("modal_rent_details_pets", pets, "modal_rent_details_guests_pets");

            if (adults > 0) {
                modal_rent_details_guests_adults.classList.remove('hidden');
            }
            if (children > 0) {
                modal_rent_details_guests_children.classList.remove('hidden');
            }
            if (pets > 0) {
                modal_rent_details_guests_pets.classList.remove('hidden');
            }

            modal_rent_details_days.value = data[0]['days'];


            // Prices
            modal_rent_details_price.innerText = data[0]['price_sum'] != null ? data[0]['price_sum'].toFixed([2]) : data[0]['price_sum'];
            modal_rent_details_price_currency.innerText = data[0]['currency_code'];
            modal_price_extra_price.innerText = Math.round(data[0]['price_extra_price'] * 100) / 100;
            modal_price_extra_price_currency.innerText = data[0]['currency_code'];
            modal_rent_details_by_day.innerText = (data[0]['price'] / data[0]['days']).toFixed([2]);
            modal_rent_details_by_day_currency.innerText = data[0]['currency_code'];
            modal_rent_details_tabs_note.value = data[0]['note_owner'];
            modal_rent_details_tabs_price_note.value = data[0]['note'];
            modal_rent_details_tabs_short_note.value = data[0]['note_short'];
            modal_rent_details_tabs_source_note.value = data[0]['rents_sources_note'];


            $(modal_rent_details_calendar).datepicker('setDate', new Date(from));
            $('#modal_rent_details_calendar .ui-datepicker-current-day').click();
            $(modal_rent_details_calendar).datepicker('setDate', new Date(until));
            $('#modal_rent_details_calendar .ui-datepicker-current-day').click();

            modal_rent_details_average_price.value = Number(data[0]['price'] / data[0]['days']).toFixed(2);
            modal_rent_details_price_full.value = data[0]['price'] != null ? data[0]['price'].toFixed([2]) : data[0]['price'];

            modal_rent_details_discount.value = data[0]['discount'];
            modal_rent_details_discount_amount.value = parseFloat(modal_rent_details_discount.value) / 100 * parseFloat(modal_rent_details_price_full.value).toFixed(2);

            modal_rent_details_in_advance_1.innerText = data[0]['in_advance'];
            modal_rent_detail_in_advance_1_currency.innerText = data[0]['advance_currency_code'];
            modal_details_rent_remaining_percent.value = data[0]['days'];

            //Set total extra price
            modal_rent_details_price_extra_price.value = data[0]['price_extra_price'] != null ? data[0]['price_extra_price'].toFixed([2]) : data[0]['price_extra_price'];

            modal_rent_details_price_sum.value = data[0]['price_full'] != null ? data[0]['price_full'].toFixed([2]) : data[0]['price_full'];
            modal_details_rent.currency_label = data[0]['currency_code'];

            modal_details_rent.days = data[0]['days'];

            modal_rent_details_total.value = (data[0]['price'] - Math.abs(parseFloat(modal_rent_details_discount_amount.value))).toFixed(2);

            modal_rent_details_advance.value = parseFloat(data[0]['in_advance']).toFixed(2) || 0;
            modal_rent_details_advance_percent.value = (parseFloat(modal_rent_details_advance.value) / parseFloat(modal_rent_details_total.value) * 100).toFixed(2);

            modal_rent_details_source_provision.value = data[0]['rent_source_provision'];
            modal_rent_details_source_provision_percent.value = parseFloat(modal_rent_details_source_provision.value) / parseFloat(modal_rent_details_price_full.value) * 100;
            modal_rent_details_price_sum_local_label.innerText = data[0]['local_currency_code'];
            modal_rent_details_price_sum_label.innerText = data[0]['currency_code'];


            //set portal source & source icon
            modal_rent_details_portal.innerText = data[0]['rents_sources_name'] || 'Syncbeds';

            if (data[0]['rent_source_icon']) {
                modal_rent_details_markup_source.src = "/assets/images/icons/portals/" + data[0]['rent_source_icon'] + ".svg";
            } else {
                modal_rent_details_markup_source.src = "/assets/images/icons/portals/syncbeds.svg";
            }

            // date when reservation is created
            let info = new Date(data[0]['created']);
            modal_rent_details_create_info.innerText = "Rezervacija je primljena " + info.getDate() + "." + (info.getMonth() + 1) + "." + info.getFullYear() + " - " + info.getHours() + ":" + info.getMinutes();


            let select_status = data[0]['rent_status'] || "";
            let status_el = document.querySelector(`li[data-name='${select_status}']`);
            if (status_el) status_el.click();

            let select_payment_name = data[0]['rent_payment_name'] || "";
            let payment_name_el = document.querySelector(`li[data-name='${select_payment_name}']`);
            if (select_payment_name && payment_name_el) payment_name_el.click();

            let selected_obj = modal_rent_details_objects_list.querySelector(`li[data-id='${data[0]['object_id']}']`);
            if (selected_obj) {
                selected_obj.click();
            }
            else {
                // Tell user about this error
                Swal.fire({
                    icon: 'error',
                    title: 'Warning!',
                    text: 'Reservation ' + data[0]['id'] + ' is not connected to any object.',
                    footer: '<a href="mailto:support@zaggys.com">Please contact zaggy support!</a>'
                });
            }

            let select_country = data[0]['contact_country_id'] || "";
            let country_el = document.querySelector(`#modal_rent_details_countries_list > li[data-id='${select_country}']`);
            if (country_el) country_el.click();

            if (false && modal_rent_details_currency.innerHTML == 'HRK') {

                modal_rent_details_by_day.innerText = (data[0]['price'] / (data[0]['days'] * data[0]['exchange'])).toFixed([2]);
                //modal_rent_details_by_person.value = ((data[0]['price'] / (data[0]['rent_adults'] + data[0]['rent_children'])) * data[0]['exchange']).toFixed([2]);
                modal_rent_details_price.innerText = (data[0]['price'] * data[0]['exchange']).toFixed([2]);
                modal_rent_details_in_advance_1.innerText = (data[0]['in_advance'] * data[0]['exchange']).toFixed([2]);

            }

            // Setup datepicker (disabled dates)
            await modal_details_rent.ui.calendar_set();

            var payment_method_type = data[0]['payment_method_type'] || '';
            let payment_method_type_select = [...document.querySelectorAll('#modal_rent_details_payment_method_type > .dropdown_li .name')]
                .filter(
                    el => el.innerHTML.trim().toUpperCase() == payment_method_type.toUpperCase()
                );

            if (payment_method_type_select.length != 0) {
                payment_method_type_select[0].click();
            }

            // changing currency label
            modal_details_rent.bl.change_currency();
            /*
                modal_rent_details_average_price_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_price_full_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_price_amount_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_price_extra_price_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_advance_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_remaining_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_remaining_extra_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_item_total_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_source_provision_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_discount_amount_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_total_label.innerText = modal_details_rent.currency_label;
                modal_rent_details_item_value_0 = modal_details_rent.currency_label;
            */
            //modal_rent_details_price_sum_local_label.innerText = modal_details_rent.currency_label; --> local currency stays the same

            modal_details_rent.bl.rent_items_load();
            modal_details_rent.ui.load_prices_per_day();
            modal_details_rent.ui.load_guests();
            bl.rents_prices_day.load(rent_id);


            // seting up global variables
            modal_details_rent.date_from = from;
            modal_details_rent.date_until = until;

            //hide sppiner
            document.getElementsByClassName('tab-content')[0].style.visibility = 'visible';
            ui.content_loading_hide('modal_rent_details_content_loading');

        }

        this.rent_to_invoice = async (invoice_type, type) => {

            ui.content_loading('calendar_content_loading');

            let url = 'api/rents/rent_to_invoice';
            let data = {};
            data['user_id'] = bl.workers.current_user_id();
            data['worker_id'] = bl.workers.current_worker_id();
            data['rent_id'] = bl.workers.current_rent_id();
            data['type'] = type;
            data['invoice_type'] = invoice_type;

            let invoice_id = await ajax.post_json(url, data);

            modal_details_rent.ui.hide_modal();

            ui.content_loading_hide('calendar_content_loading');

            window.location.href = "/#bills_edit?" + invoice_id;
        }

        this.load_payments = async () => {

            let url = "/api/payments_recive/list_all_payments?user_id=" + bl.workers.current_user_id() + "&rent_id=" + modal_details_rent.rent_id;
            var data = await ajax.get_json(url);

            //js.template.get('modal_rent_details_payment_list', url);

            js.template.data('modal_rent_details_payment_list', data);

        }

        this.click_to_price_per_day = function () {

            console.log("clicked");

            let id = document.getElementById("rent_details_modal");
            // Remove active details & content
            id.getElementsByClassName("modal_ul")[0].children[0].children[0].classList.remove("active");
            id.getElementsByClassName("tab-content")[0].children[0].classList.remove("active");
            // Add active price per day & content
            id.getElementsByClassName("modal_ul")[0].children[1].children[0].classList.add("active");
            id.getElementsByClassName("tab-content")[0].children[1].classList.add("active");

        }

        // Dropdown range calendar
        this.toggle_dropdown_calendar = function (id) {

            let dropdown_id = document.getElementById(id);
            let dropdown_menu = dropdown_id.getElementsByClassName("modal_dropdown_menu_calendar")[0];
            let dropdown_btn = dropdown_id.getElementsByClassName("btn")[0];


            dropdown_btn.addEventListener("click", function () {

                if (dropdown_btn.classList.contains("open")) {
                    dropdown_btn.classList.remove("open");
                    dropdown_menu.classList.add("hidden");
                } else {
                    dropdown_btn.classList.add("open");
                    dropdown_menu.classList.remove("hidden");
                }

            });

            document.addEventListener('mouseup', function (e) {
                if (dropdown_id.outerHTML.includes(e.target.outerHTML) == false) {
                    dropdown_btn.classList.remove("open");
                    dropdown_menu.classList.add("hidden");
                }
            });

        }

        // Icon portal dropdown
        this.icon_portal_dropdown = function (id) {

            let dropdown_id = document.getElementById(id);
            let dropdown_menu = dropdown_id.getElementsByClassName("dropdown_menu")[0];
            let dropdown_btn = dropdown_id.getElementsByClassName("btn")[0];
            //let dropdown_name = dropdown_id.getElementsByClassName("modal_rent_id")[0];
            let dropdown_icon = dropdown_id.getElementsByClassName("modal_icon")[0].children[0];;

            dropdown_btn.addEventListener("click", function () {
                if (dropdown_btn.classList.contains("open")) {
                    dropdown_btn.classList.remove("open");
                    dropdown_menu.classList.add("hidden");
                } else {
                    dropdown_btn.classList.add("open");
                    dropdown_menu.classList.remove("hidden");
                }

            });

            document.addEventListener('mouseup', function (e) {
                if (dropdown_id.outerHTML.includes(e.target.outerHTML) == false) {
                    dropdown_btn.classList.remove("open");
                    dropdown_menu.classList.add("hidden");
                }

            });

            for (let i = 0; i < dropdown_menu.children.length; i++) {

                //get element
                const element = dropdown_menu.children[i];

                //handle on click for each source
                element.onclick = function (e) {

                    //set source name
                    var name = e.target.getElementsByClassName("name align-self-center")[0].innerHTML;
                    modal_rent_details_portal.innerHTML = name;

                    //set source id
                    modal_rent_details_rent_source_dropdown.dataset.id = e.target.dataset.id;
                    dropdown_id.dataset.id = e.target.dataset.source;

                    //set source logo
                    dropdown_icon.src = e.target.getElementsByClassName("icon_img")[0].children[0].src;


                    dropdown_menu.classList.add("hidden");
                    dropdown_btn.classList.remove("open");
                }

            }

        }

        // Toggle dropdown
        this.toggle_dropdown = function (id) {

            let dropdown_id = document.getElementById(id);
            let dropdown_menu = dropdown_id.getElementsByClassName("dropdown_menu")[0];
            let dropdown_btn = dropdown_id.getElementsByClassName("btn")[0];

            dropdown_btn.addEventListener("click", function () {
                
                if (dropdown_btn.classList.contains("open")) {
                    dropdown_btn.classList.remove("open");
                    dropdown_menu.classList.add("hidden");
                } else {
                    dropdown_btn.classList.add("open");
                    dropdown_menu.classList.remove("hidden");
                }

            });

            document.addEventListener('mouseup', function (e) {
                if (dropdown_id.outerHTML.includes(e.target.outerHTML) == false) {
                    dropdown_btn.classList.remove("open");
                    dropdown_menu.classList.add("hidden");
                }
            });

        };

        // input counter
        this.input_counter = function (id, value, label) {
            let input_id = document.getElementById(id);
            let minus = input_id.getElementsByClassName("minus")[0];
            let plus = input_id.getElementsByClassName("plus")[0];
            let input = input_id.getElementsByClassName("form-control")[0];

            let current = input.value = value;
            let counter = current;

            let get_label = document.getElementById(label);
            get_label.getElementsByTagName("span")[0].textContent = value;

            if (get_label.getElementsByTagName("span")[0].textContent > 0) {
                get_label.classList.remove("hidden");
            } else {
                get_label.classList.add("hidden");
            }

            minus.addEventListener("click", function () {
                if (value < counter) {
                    counter--;
                    input.value = counter;
                    get_label.getElementsByTagName("span")[0].textContent = counter;
                    if (get_label.getElementsByTagName("span")[0].textContent == 0) {
                        get_label.classList.add("hidden");
                    }
                }

            });
            plus.addEventListener("click", function () {
                counter++;
                input.value = counter;

                get_label.getElementsByTagName("span")[0].textContent = counter;
                if (get_label.getElementsByTagName("span")[0].textContent > 0) {
                    get_label.classList.remove("hidden");
                } else {
                    get_label.classList.add("hidden");
                }
            });
        }

        // generate day between dates that are selected on calendar and calculate price for every day
        this.generate_price_day = async () => {

            var url = '/api/rents_prices_days/generate_days/' + modal_details_rent.rent_id;

            await ajax.get(url);
        }

        // save price for every day
        this.save_prices_per_day = async () => {

            var prices = {};
            //var url = '/api/rents_prices_days/save_day';
            //prices.rent_id = modal_details_rent.rent_id;

            var list_lenght = document.querySelectorAll('.list_per_day > div').length;
            var prices_list = bl.rents_prices_day.list();
            for (var i = 0; i < list_lenght; i++) {
                prices.date = document.querySelector(`input[data-id='${prices_list[i]['id']}']`).dataset.date;
                prices.price = document.querySelector(`input[data-id='${prices_list[i]['id']}']`).value;
            }

            //var response = ajax.post(url, prices);
            //response.then(function (text) {
            //});
        }

        // Saving changes into object
        this.save_rent = async () => {

            await ui.content_loading('modal_rent_details_content_loading');

            var rent = {};

            //rent data
            rent.object_id = modal_rent_details_object.dataset.id;
            rent.rent_id = modal_rent_details_rent_id.innerHTML;
            rent.in_advance = modal_rent_details_in_advance_1.innerText;
            rent.price = modal_rent_details_price.innerHTML;
            rent.contact_name = modal_rent_details_contact_name.value;
            rent.contact_email = modal_rent_details_contact_email.value;
            rent.contact_tel = modal_rent_details_contact_tel.value;
            rent.rent_pets = modal_rent_details_guests_pets.innerText.replace(/[^0-9]/g, '');
            rent.rent_children = modal_rent_details_guests_children.innerText.replace(/[^0-9]/g, '');
            rent.rent_adults = modal_rent_details_guests_adults.innerText.replace(/[^0-9]/g, '');
            //notes
            rent.note_owner = modal_rent_details_tabs_note.value;
            rent.note = modal_rent_details_tabs_price_note.value;
            rent.note_short = modal_rent_details_tabs_short_note.value;

            rent.rent_status_id = document.getElementById('modal_rent_details_custom_status').dataset.id;
            //if (modal_rent_details_rent_source_dropdown.dataset.id) {
            //    rent.rent_source_id = modal_rent_details_rent_source_dropdown.dataset.id;
            //}
            rent.rent_source_id = modal_rent_details_rent_source_dropdown.dataset.id || null;
            rent.payment_method_id = document.getElementById('modal_rent_details_paid').dataset.id;
            rent.from_date = modal_rent_details_calendar_check_in.dataset.day;
            rent.until_date = modal_rent_details_calendar_check_out.dataset.day;
            rent.contact_country_id = document.getElementById('modal_filter_country').dataset.id;
            rent.object_name = modal_rent_details_object.dataset.name;
            rent.currency_id = modal_rent_currency_id.dataset.id;

            //pricing data

            rent.price = modal_rent_details_price_full.value;
            rent.exchange = modal_rent_details_exchange.value;
            rent.rent_source_provision = modal_rent_details_source_provision.value;
            rent.discount = modal_rent_details_discount.value;
            //total_price = modal_rent_details_price_sum.value;
            rent.in_advance = modal_rent_details_advance.value;

            //console.log("RENT TO SAVE",rent);

            var url = '/api/rents/save';

            var response = await ajax.post_json(url, rent);

            // refresh to see new reservations
            if (location.hash.split('?')[0] == '#calendar') {
                calendar.bl.refresh_page();
            }
            else {
                console.log('modal searching rents');
                bl.rents.list();
            }

            //hide modal
            await modal_details_rent.ui.hide_modal();

            // on load
            if (location.hash.split('?')[0] != '#calendar') {
                rents.load();
            }

            //hide sppiner
            ui.content_loading_hide('modal_rent_details_content_loading');

        }

        // delete reservations
        this.delete_reservation = async () => {

            ui.content_loading('modal_rent_details_content_loading');

            //debugger;

            var worker = bl.workers.current_worker_id();
            var url = `/api/rents/del/${modal_details_rent.rent_id}?worker_id=${worker}`;
            var response = await ajax.get(url);

            //Refresh local storage
            // bl.rents.list_on_start();

            ui.content_loading_hide('modal_rent_details_content_loading');
            modal_details_rent.ui.hide_modal();
            var current_page = page.get_current_page();

            if (current_page == 'calendar') {
                calendar.bl.refresh_page();
            }

            if (current_page == "object_calendars") {
                routing.reload();
            }

            if (current_page == "rents") {
                rents.load();
            }

        }

        // Sending chat message from ui to database
        this.chat_messages = () => {

            ui.content_loading('modal_rent_details_content_loading');

            var chat = {};

            chat.worker_id = bl.workers.current_worker_id();
            chat.rent_id = modal_details_rent.rent_id;
            chat.object_id = modal_details_rent.object_id;
            chat.creator = 'user';
            chat.source = 'web';
            chat.source_info = 'light.zaggy.net';
            chat.messages = document.getElementById('model_rent_details_chatbox').value;
            model_rent_details_chatbox.value = '';

            var url = '/api/messages/save';
            var response = ajax.post_json(url, chat);

            response.then(function (text) {
                modal_details_rent.ui.load_messages();
            });

            ui.content_loading_hide('modal_rent_details_content_loading');

        }

        // save all changes from tab "Price"
        this.save_prices = async () => {
            this.save_rent();
        }

        this.copy_to_clipboard = function (event, el) {

            bl.copy_to_clipboard(parseInt(modal_rent_details_rent_id.innerText));
            let icon = el.children[0];

            // Temporary change of icon and tooltip
            icon.classList.replace('far', 'fas');
            $(el).tooltip('hide');
            el.dataset.originalTitle = 'Copied!';
            $(el).tooltip('show');

            setTimeout(function () {
                icon.classList.replace('fas', 'far');
                $(el).tooltip('hide');
                el.dataset.originalTitle = 'Copy ID';
            }, 500);

            // Stop source modal from opening
            event.stopPropagation();
        }

        // calculating total price of all items
        this.change_items_total_price = (id) => {

            // debugger;

            if (modal_rent_details_item_tax.value == '' && modal_rent_details_item_amount.value == '') {
                modal_rent_details_item_tax.value = 0;
                modal_rent_details_item_amount.value = 1;
            }

            //Save price in database

            //debugger;

            modal_details_rent.bl.update_row(`modal_rent_details_tr_` + id, id);


            if (id == 'modal_rent_details_tr') {
                var total_price = document.getElementById('modal_rent_details_item_price').value * document.getElementById('modal_rent_details_item_amount').value;

                var vat = document.getElementById('modal_rent_details_item_tax').value;
                if (vat != 0) {
                    total_price = total_price * (1 + vat / 100);
                    document.getElementById('modal_rent_details_item_total').value = total_price;
                }

                document.getElementById('modal_rent_details_item_total').value = total_price.toFixed([2]);
            } else {
                numb = id.split('_')[4];

                var total_price = document.getElementById('modal_rent_details_item_price_' + id).value * document.getElementById('modal_rent_details_item_amount_' + id).value;

                var vat = document.getElementById('modal_rent_details_item_tax_' + id).value;
                if (vat != 0) {
                    total_price = total_price * (1 + vat / 100);
                    document.getElementById('modal_rent_details_item_total_' + id).value = total_price.toFixed([2]);
                }

                document.getElementById('modal_rent_details_item_total_' + id).value = total_price.toFixed([2]);
            }

            //Calulate total price for all items
            this.total_item_price();

        }

        // Calculate info price total
        this.total_item_price_new = () => {

            var elem_price = modal_rent_details_item_price.value || 0;
            var elem_amount = modal_rent_details_item_amount.value || 1;
            var elem_tax = modal_rent_details_item_tax.value || 0;

            var total_price = (elem_price * (1 + elem_tax / 100) * elem_amount).toFixed(2);

            modal_rent_details_item_total.value = total_price;

        }

        // price for all items
        this.total_item_price = () => {

            //debugger;

            // sum prices of items to get total price for items
            var items = document.querySelectorAll('#modal_rent_details_tbody > tr[data-id]');

            var total_price = 0;
            for (i = 0; i < items.length; i++) {

                var id = items[i].dataset.id;

                let elem_price = "modal_rent_details_item_price_" + id;
                let elem_amount = "modal_rent_details_item_amount_" + id;
                let elem_tax = "modal_rent_details_item_tax_" + id;

                let item_cost = parseFloat(document.getElementById(elem_price).value || 0) * parseFloat(document.getElementById(elem_amount).value || 0);
                item_cost = item_cost + (parseFloat(document.getElementById(elem_tax).value || 0).toFixed(2) / 100 * item_cost);

                //Calculate total price
                total_price += item_cost;


                //total_price = total_price + parseFloat(document.getElementById('modal_rent_details_item_total_' + i).value);
                //TODO: Dodati provjeru za nulu
                //total_price = total_price + parseFloat(document.getElementById('modal_rent_details_item_total_' + id).value);
            }

            modal_rent_details_price_extra_price.value = total_price.toFixed(2);

            //let item_number = modal_rent_details_tr.parentNode.children.length;

            //let extra_price = 0;

            //for (i = 1; i < item_number; i++) {
            //    let elem = "modal_rent_details_item_price_" + i;
            //    console.log(elem);
            //}

            //document.getElementById('modal_rent_details_price_extra_price').value = total_price;
            this.calculate_total_items_prices();
        }

        //updating one row in items list
        this.update_row = async (html_element_id, rent_item_id) => {

            let html_element_id_num = html_element_id.split("_").pop();

            //debugger;

            let new_values = {};

            new_values.id = rent_item_id;
            new_values.rent_id = modal_details_rent.rent_id;
            new_values.currency_id = modal_details_rent.currency_id;
            new_values.name = document.getElementById("modal_rent_details_service_" + html_element_id_num).value;
            new_values.price = document.getElementById("modal_rent_details_item_price_" + html_element_id_num).value;
            new_values.quantity = parseInt(document.getElementById("modal_rent_details_item_amount_" + html_element_id_num).value);
            new_values.vat = parseInt(document.getElementById("modal_rent_details_item_tax_" + html_element_id_num).value);

            let url = '/api/rents_items/update_row';
            let response = await ajax.post_json(url, new_values);

        }

        // deleting one row in items list
        this.delete_row = async (id, rent_item_id) => {

            document.getElementById(id).remove();
            var url = '/api/rents_items/del/' + rent_item_id;
            var response = await ajax.post_json(url);

        }

        // deleting one guest from guest list
        this.delete_guest = async (elem) => {

            let guest_id = elem.dataset.id;

            //elem.remove();
            var url = '/api/guests/delete/' + guest_id;
            var response = await ajax.post_json(url);
            await modal_details_rent.ui.load_guests();

        }

        // calculate total items
        this.calculate_total_items_prices = () => {


            var price_total = modal_rent_details_total.value;
            var price_extra = modal_rent_details_price_extra_price.value;

            var price_sum = modal_rent_details_price_sum.value;
            var price_remaining_percent = modal_details_rent_remaining_percent.value;

            modal_rent_details_price_sum.value = parseFloat(price_total) + parseFloat(price_extra);
            modal_rent_details_advance.value = parseFloat(price_sum) / parseFloat(price_remaining_percent).toFixed(2);


            modal_rent_details_price_sum_local.value = (parseFloat(modal_rent_details_price_sum.value) * parseFloat(modal_rent_details_exchange.value)).toFixed(2);

            //this.calculate_discount();
            this.change_advance_price();

            //modal_rent_details_advance.value = modal_rent_details_price_sum_local.value / modal_details_rent_nights;
        }

        //calculate sum in local currency
        this.calculate_local_sum = () => {

            modal_rent_details_price_sum_local.value = (parseFloat(modal_rent_details_price_sum.value) * parseFloat(modal_rent_details_exchange.value)).toFixed(2);

        }

        //calculate reamining percent and value
        this.calculate_remaining = () => {

            let advance_percent = modal_rent_details_advance_percent.value;

            if (advance_percent > 100) {
                modal_rent_details_advance_percent.value = 100;
            } else if (advance_percent < 0) {
                modal_rent_details_advance_percent.value = 0;
            }

            modal_details_rent_remaining_percent.value = (100 - Math.abs(parseFloat(modal_rent_details_advance_percent.value) || 100)).toFixed(2);

            modal_rent_details_remaining.value = (parseFloat(modal_rent_details_price_sum.value).toFixed(2) - Math.abs(parseFloat(modal_rent_details_advance.value || 0))).toFixed(2);

            modal_details_rent_remaining_extra.value = parseFloat(modal_rent_details_price_extra_price.value).toFixed(2);

        }

        // calculate discount on change
        this.calculate_discount = () => {

            modal_rent_details_discount_amount.value = (parseFloat(modal_rent_details_discount.value || 0) / 100 * parseFloat(modal_rent_details_price_full.value)).toFixed(2);

            this.calculate_total_items_prices();

        }

        //calculate source provision
        this.calculate_provision = () => {

            modal_rent_details_source_provision.value = (parseFloat(modal_rent_details_source_provision_percent.value || 0) / 100 * parseFloat(modal_rent_details_price_full.value || 0)).toFixed(2);
            //this.calculate_total_items_prices();

        }

        //calculate total accommodation cost
        this.calculate_total = () => {

            let discount = parseFloat(modal_rent_details_discount_amount.value || 0);
            let full_price = parseFloat(modal_rent_details_price_full.value || 0);

            modal_rent_details_total.value = (full_price + discount).toFixed(2);

            this.calculate_total_items_prices();

        }

        //calculate provision percentage from provision amount
        this.calculate_provision_percent = () => {

            let provision = parseFloat(modal_rent_details_source_provision.value || 0);
            let full_price = parseFloat(modal_rent_details_price_full.value || 0);

            modal_rent_details_source_provision_percent.value = (provision / full_price * 100).toFixed(2);
            //this.calculate_total_items_prices();

        }

        //calculate discount percentage from discount amount
        this.calculate_discount_percent = () => {

            let discount = parseFloat(modal_rent_details_discount_amount.value || 0);
            let full_price = parseFloat(modal_rent_details_price_full.value || 0);

            modal_rent_details_discount.value = Math.abs(discount / full_price * 100).toFixed(2);
            //this.calculate_total_items_prices();

        }

        this.extra_charges_clear = () => {
            //clear all inputs in extra charges
            document.getElementById("modal_rent_details_item_name").value = "";
            document.getElementById("modal_rent_details_item_price").value = "0";
            document.getElementById("modal_rent_details_item_amount").value = "1";
            document.getElementById("modal_rent_details_item_tax").value = "0";
        }

        // calculating advance price after changing advance percentage
        this.change_advance_percent = () => {

            let advance = modal_rent_details_advance.value;

            if (advance > parseFloat(modal_rent_details_total.value || 0)) {
                modal_rent_details_advance.value = modal_rent_details_total.value;
            } else if (advance < 0) {
                modal_rent_details_advance.value = 0;
            }

            advance = parseFloat(modal_rent_details_advance.value || 0);
            let total = parseFloat(modal_rent_details_total.value || 0);

            modal_rent_details_advance_percent.value = (advance / total * 100).toFixed(2);


            this.calculate_remaining();

            //&modal_rent_details_in_advance.value = (modal_rent_details_price_sum_local.value * (modal_rent_details_advance_percent.value / 100)).toFixed([2]);
            //modal_rent_details_price_difference.value = (modal_rent_details_price_sum_local.value - modal_rent_details_in_advance.value).toFixed([2]);
        }

        // calculating advance percentage after changing advance price
        this.change_advance_price = () => {

            let advance_percent = modal_rent_details_advance_percent.value;

            if (advance_percent > 100) {
                modal_rent_details_advance_percent.value = 100;
            } else if (advance_percent < 0) {
                modal_rent_details_advance_percent.value = 0;
            }

            modal_rent_details_advance.value = (Math.abs(parseFloat(modal_rent_details_advance_percent.value || 0)) / 100 * parseFloat(modal_rent_details_total.value || 0)).toFixed(2);

            this.calculate_remaining();
            //if (modal_rent_details_in_advance.value != 0 && modal_rent_details_price_sum_local.value != 0) {
            //    modal_rent_details_advance_percent.value = ((modal_rent_details_in_advance.value / modal_rent_details_price_sum_local.value) * 100).toFixed([2]);
            //    //modal_rent_details_price_difference.value = (modal_rent_details_price_sum_local.value - modal_rent_details_in_advance.value).toFixed([2]);
            //}

        }

        //opens invoices for printing in a new tab
        this.print_bills = async (element) => {

            let guid_url = 'https://api.zaggys.com/invoices/pdf/' + element.dataset.guid;

            window.open(guid_url, '_blank');

        }

        this.reset_card_data = () => {

            modal_card_details_pin1.value = '';
            modal_card_details_pin2.value = '';
            modal_card_details_card_type.value = '';
            modal_card_details_card_number.value = '';
            modal_card_details_date_from.value = '';
            modal_card_details_date_until.value = '';
            modal_card_details_cvv.value = '';
            modal_card_details_owner_name.value = '';

        }

        this.save_card_data = () => {

            var card = {};

            card.pin1 = modal_card_details_pin1.value;
            card.pin2 = modal_card_details_pin2.value;
            card.card_type = modal_card_details_card_type.value;
            card.number = modal_card_details_card_number.value;
            card.date_from = modal_card_details_date_from.value;
            card.date_until = modal_card_details_date_until.value;
            card.cvv = modal_card_details_cvv.value;
            card.owner_name = modal_card_details_owner_name.value;

            //TODO : send data to api and save to DB

        }

        this.change_currency = () => {

            //debugger;

            //Set global currency
            modal_details_rent.currency_label = modal_rent_currency_id.innerText;

            //Set global currency id
            let local_storage_registars_currencies = JSON.parse(localStorage.getItem("registars")).currency;

            for (let i = 0; i < local_storage_registars_currencies.length; i++) {

                let item = local_storage_registars_currencies[i];

                if (item.code == modal_details_rent.currency_label) {
                    modal_details_rent.currency_id = item.id;
                }
            }

            let curr = modal_details_rent.currency_label;

            modal_rent_details_average_price_label.innerText = curr;
            modal_rent_details_price_full_label.innerText = curr;
            modal_rent_details_source_provision_label.innerText = curr;
            modal_rent_details_discount_amount_label.innerText = curr;
            modal_rent_details_total_label.innerText = curr;
            modal_rent_details_item_total_label.innerText = curr;
            modal_rent_details_price_amount_label.innerText = curr;
            modal_rent_details_price_extra_price_label.innerText = curr;
            modal_rent_details_advance_label.innerText = curr;
            modal_rent_details_remaining_extra_label.innerText = curr;
            modal_rent_details_remaining_label.innerText = curr;
            modal_rent_details_average_price_label.innerText = curr;
            modal_rent_details_price_sum_label.innerText = curr;
            modal_rent_details_price_sum_local_label.innerText = curr;

            modal_details_rent.ui.extra_item_currency_display(curr);


            //Extra charges rows in extra charges table
            let extra_charges_rows = modal_rent_details_tbody.querySelectorAll("[data-id]");

            for (let i = 0; i < extra_charges_rows.length; i++) {

                let item = extra_charges_rows[i];

                let price_currency_element = item.children[1].children[0].children[1];
                let total_currency_element = item.children[4].children[0].children[1];

                price_currency_element.innerText = curr;
                total_currency_element.innerText = curr;
            }

        }

        // editing guest
        this.edit_guest = async (id) => {

            ui.content_loading("modal_rent_details_content_loading");

            var guest = {};

            let isCityNameOk;
            let country_name;

            try { country_name = document.getElementById("modal_edit_dropdown_example_country_search").children[0].children[1].children[0].children[1].innerText; }
            catch { country_name = null; }

            //Check if city for Croatia is inputed -> accepts only letters spaces and '
            let inputCityElement = document.getElementById("modal_edit_guest_details_city");

            if (inputCityElement.value.length > 0 && country_name == 'Croatia') {

                isCityNameOk = Boolean((inputCityElement.value).match(/^[A-Za-z ']*$/));
            }
            else if (country_name != 'Croatia' && country_name) {

                isCityNameOk = true;

            } else {

                isCityNameOk = false;
            }

            if (isCityNameOk) {

                // guest
                guest.name_first = modal_edit_guest_details_first_name.value;
                guest.name_last = modal_edit_guest_details_last_name.value;
                guest.visible_on_invoice = modal_rent_details_guest_visible_on_invoice.checked == true ? 'Y' : 'N';
                guest.city_tax = modal_rent_details_city_tax.checked == true ? 'Y' : 'N';
                guest.date_from = modal_edit_guest_details_date_from.value;
                guest.date_until = modal_edit_guest_details_date_until.value;
                guest.note = modal_edit_guest_details_note.value;

                // guest evisitor
                guest.birth_date = modal_edit_guest_details_date_birth.value;
                //guest.birth_country = modal_edit_guest_details_country.dataset.code1;
                guest.birth_country = document.getElementById("modal_edit_dropdown_example_country_search").children[0].children[1].children[0].dataset.code1;
                guest.birth_city = modal_edit_guest_details_city.value;
                guest.document_number = modal_edit_guest_details_document_number.value;
                guest.document_type = modal_edit_guest_details_type_of_document_btn.dataset.id;
                guest.gender = modal_edit_guest_details_sex_type_M.checked == true ? 'muški' : 'ženski';
                guest.arrival_organisation = modal_edit_guest_details_select_arrival_organization_btn.dataset.id;
                //guest.citizenship = modal_edit_guest_details_select_citizenship_btn.dataset.code1;
                guest.citizenship = document.getElementById("modal_edit_dropdown_example_country_search_citizenship").children[0].children[1].children[0].dataset.code1;
                guest.residence_city = modal_edit_guest_details_place_of_residence.value;
                //guest.residence_country = modal_edit_guest_details_select_country_btn.dataset.code1;
                guest.residence_country = document.getElementById("modal_edit_dropdown_example_country_search_residence").children[0].children[1].children[0].dataset.code1;
                guest.tt_payment_category = modal_edit_guest_details_category.dataset.id;
                guest.offered_service_type = 'noćenje';
                //guest.category_id = modal_edit_guest_details_category.dataset.id;
                guest.guest_id = modal_details_rent.guest_id;

                // api call for saving guest to guests table and to guests_evisitor
                url = '/api/guests/save_guest/';
                response = await ajax.post_json(url, guest);

                this.clear_edit_guest();

            } else {
                console.log('FAILED to edit existing guest -> City for Croatia must be inputed !!!');
            }
        }

        // clearing all from edit guest tab
        this.clear_edit_guest = () => {
            modal_edit_guest_details_first_name.value = '';
            modal_edit_guest_details_last_name.value = '';
            modal_edit_guest_details_city.value = '';
            modal_edit_guest_details_city.dataset.id = '';
            modal_edit_guest_details_select_arrival_organization_btn.value = '';
            modal_edit_guest_details_select_arrival_organization_btn.dataset.id = '';
            //modal_edit_guest_details_select_citizenship_btn.innerText = '';
            //modal_edit_guest_details_select_citizenship_btn.dataset.id = '';
            //modal_edit_guest_details_select_citizenship_btn.dataset.code1 = '';
            modal_edit_guest_details_document_number.value = '';
            modal_edit_guest_details_country.innerText = '';
            modal_edit_guest_details_country.dataset.id = '';
            modal_edit_guest_details_note.value = '';
            modal_edit_guest_details_country.innerText = '';
            modal_edit_guest_details_category.innerText = '';
            modal_edit_guest_details_country.innerText = '';
            //modal_edit_guest_details_select_country_btn.innerText = '';
            modal_edit_guest_details_place_of_residence.value = '';
            modal_edit_guest_details_date_birth.value = '';
            modal_edit_guest_details_date_from.value = '';
            modal_edit_guest_details_date_until.value = '';
            modal_edit_guest_details_type_of_document_btn.innerText = '';
            modal_edit_guest_details_type_of_document_btn.dataset.id = '';
            modal_rent_details_city_tax.checked = false;
            modal_rent_details_guest_visible_on_invoice.checked = false;

            modal_details_rent.ui.load_guests();
            document.querySelector('#modal_body_guests_list_tab').click();

            ui.content_loading_hide("modal_rent_details_content_loading");

        }

        // adding new guest to database
        this.add_guest = async () => {

            // It is not possible to add a guest if all fields are not filled
            var required_fields = document.querySelectorAll('[required]');
            let is_valid = true;

            // Check text fields
            required_fields.forEach((field) => {
                if (!field.value) {
                    is_valid = false;
                    field.classList.add('border-danger');
                } else {
                    field.classList.remove('border-danger');
                }
            });

            // Check dropdown
            var required_dropdown_fields = document.querySelectorAll('[required_dropdown]');
            required_dropdown_fields.forEach((field) => {
                if (!field.innerText) {
                    is_valid = false;
                    field.classList.add('border-danger');
                } else {
                    field.classList.remove('border-danger');
                }
            });


            if (!is_valid) {

                // Tell user to fill out all fields
                Swal.fire({
                    icon: 'warning',
                    title: 'Warning!',
                    text: 'Please fill in all required fields',
                    showCancelButton: false
                });

                return;
            }


            // If all fields are filled out correctly, add guest
            ui.content_loading("modal_rent_details_content_loading");

            let guest = {};

            let isCityNameOk;
            let country_name;

            try { country_name = document.getElementById("modal_add_dropdown_example_country_search").children[0].children[1].children[0].children[1].innerText; }
            catch { country_name = null; }

            //Check if city for Croatia is inputed -> accepts only letters spaces and '
            let inputCityElement = document.getElementById("modal_add_guest_details_city");

            if (inputCityElement.value.length > 0 && country_name == 'Croatia') {

                isCityNameOk = Boolean((inputCityElement.value).match(/^[A-Za-z ']*$/));
            }
            else if (country_name != 'Croatia' && country_name) {

                isCityNameOk = true;

            } else {

                isCityNameOk = false;
            }


            if (isCityNameOk) {

                guest.name_first = modal_add_guest_details_first_name.value;
                guest.name_last = modal_add_guest_details_last_name.value;
                guest.birth_date = modal_add_guest_details_date_birth.value;
                //guest.birth_country = modal_add_guest_details_country.dataset.code1;
                //guest.birth_country = country_name;
                guest.birth_country = document.getElementById("modal_add_dropdown_example_country_search").children[0].children[1].children[0].dataset.code1;
                guest.birth_city = modal_add_guest_details_city.value;
                guest.document_number = modal_add_guest_details_document_number.value;
                guest.document_type = modal_add_guest_details_country_btn.dataset.id;
                //guest.citizenship = modal_add_guest_details_select_citizenship_btn.dataset.code1;
                guest.citizenship = document.getElementById("modal_add_dropdown_example_country_search_citizenship").children[0].children[1].children[0].dataset.code1;
                guest.residence_city = modal_add_guest_details_place_of_residence.value;
                //guest.residence_country = modal_add_guest_details_select_country_btn.dataset.code1;
                guest.residence_country = document.getElementById("modal_add_dropdown_example_country_search_residence").children[0].children[1].children[0].dataset.code1;
                guest.gender = modal_add_guest_details_sex_type_M.checked == true ? 'muški' : 'ženski';
                guest.date_from = modal_add_guest_details_date_from.value == '' ? alert('Date from is required') : modal_add_guest_details_date_from.value;
                guest.date_until = modal_add_guest_details_date_until.value == '' ? alert('Date until is required') : modal_add_guest_details_date_until.value;

                // api call for creating row inside guests table
                var url = '/api/guests/add/' + modal_details_rent.rent_id;
                var response = await ajax.get_json(url);

                guest.guest_id = response;

                // api call for creating row inside guests_evsitor table
                url = '/api/guests/add_evisitor/' + guest.guest_id;
                response = await ajax.get_json(url);

                // api call for saving guest to database
                url = '/api/guests/save_guest/';
                response = await ajax.post_json(url, guest);

                this.clear_add_guest();

            } else {
                console.log('FAILED to add new guest -> City for Croatia must be inputed !!!');
            }

            ui.content_loading_hide("modal_rent_details_content_loading");
        }

        // add to database evisitor
        this.add_guest_to_evisitor = async () => {
            // api call for creating row inside guests table
            var url = '/api/guests/add_evisitor/' + modal_details_rent.guest_id;
            var response = await ajax.post_json(url);
        }

        // clearing all from add guest tab
        this.clear_add_guest = () => {

            //debugger;

            modal_add_guest_details_first_name.value = '';
            modal_add_guest_details_last_name.value = '';
            modal_add_guest_details_city.value = '';
            modal_add_guest_details_city.dataset.id = '';
            //modal_add_guest_details_select_citizenship_btn.innerText = '';
            //modal_add_guest_details_select_citizenship_btn.dataset.id = '';
            //modal_add_guest_details_select_citizenship_btn.dataset.code1 = '';
            modal_add_guest_details_document_number.value = '';
            modal_add_guest_details_country_btn.innerText = '';
            modal_add_guest_details_country_btn.dataset.id = '';
            modal_add_guest_details_country.innerText = '';
            //modal_add_guest_details_select_country_btn.innerText = '';
            modal_add_guest_details_place_of_residence.value = '';
            modal_add_guest_details_date_birth.value = '';
            modal_add_guest_details_sex_type_M.checked = false
            modal_add_guest_details_sex_type_F.checked = false
            modal_add_guest_details_date_from.value = '';
            modal_add_guest_details_date_until.value = '';

            document.querySelector('#modal_body_guests_list_tab').click();
        }

        // on change price per day changing prices in "prices per day"
        this.calculate_prices_per_day = () => {

            modal_rent_details_price_full.value = Number(modal_rent_details_average_price.value * modal_rent_details_days.value).toFixed(2);
            var days = document.querySelectorAll('#modal_rent_details_list_per_day > div > div > input');
            for (var d of days) {
                d.value = Number(modal_rent_details_average_price.value).toFixed(2);
            }

            modal_rent_details_price_sum.innerText = 'Price: ' + Number((modal_rent_details_price_full.value + modal_rent_details_discount_amount.value)).toFixed(2);

            modal_details_rent.bl.price_change();

            modal_details_rent.bl.calculate_discount();
            modal_details_rent.bl.calculate_provision();
            modal_details_rent.bl.calculate_total();

        }

        // on change price changing price per day
        this.price_change = () => {

            modal_rent_details_average_price.value = (modal_rent_details_price_full.value / parseInt(modal_details_rent.days)).toFixed(3);
            modal_rent_details_price_sum_local.value = parseFloat((modal_rent_details_price_full.value + modal_rent_details_price_extra_price.value)).toFixed(2);

            modal_rent_details_price_full.value = Number(modal_rent_details_average_price.value * modal_rent_details_days.value).toFixed(2);
            var days = document.querySelectorAll('#modal_rent_details_list_per_day > div > div > input');
            for (var d of days) {
                d.value = Number(modal_rent_details_average_price.value).toFixed(2);
            }

            modal_rent_details_price_sum.innerText = 'Price: ' + Number((modal_rent_details_price_full.value + modal_rent_details_discount_amount.value)).toFixed(2);

            modal_details_rent.bl.calculate_discount();
            modal_details_rent.bl.calculate_provision();
            modal_details_rent.bl.calculate_total();
        }

        // on change prices for specifice day changing price
        this.price_change_day = () => {

            var price = 0;
            // get all days
            var prices_days = document.querySelectorAll('#modal_rent_details_list_per_day > div > div >input');
            for (var d of prices_days) {
                price = price + parseFloat(d.value);
            }

            modal_rent_details_price_full.value = Number(price).toFixed(2);

            modal_details_rent.bl.price_change();
        }

        // loading rent items list from database
        this.rent_items_load = async () => {

            //debugger;

            var trs = document.querySelectorAll('#modal_rent_details_tbody > tr')
            for (var tr of trs) {
                if (!tr.dataset.id == false) {
                    tr.remove();
                }
            }

            // selecting items for rents
            var url = '/api/rents_items/list/' + modal_details_rent.rent_id;
            var json_rents_items = await ajax.get_json(url);

            //var json_rents_items = JSON.parse(rents_items);

            // console.log("ITEM", json_rents_items);

            // id for tr
            modal_details_rent.items_number = 0;

            // add new items
            for (var item of json_rents_items) {

                //debugger;
                var id = item['id'];

                modal_details_rent.flag = 1;
                modal_details_rent.ui.insert_items_row(id);
                //var id = document.getElementById('modal_rent_details_tr_' + numb);
                var price = document.getElementById('modal_rent_details_item_price_' + id);
                var tax = document.getElementById('modal_rent_details_item_tax_' + id);
                var amount = document.getElementById('modal_rent_details_item_amount_' + id);
                var total = document.getElementById('modal_rent_details_item_total_' + id);
                var name = document.getElementById('modal_rent_details_service_' + id);

                price.value = item['price'] || "0";
                name.value = item['name'] || "Unnamed expense";
                tax.value = item['vat'] || "0";
                amount.value = item['quantity'] || "0";
                total.value = item['price_full_price'];

                document.getElementById('modal_rent_details_tr_' + id).dataset.id = item['id'];
                modal_details_rent.flag = 0;
            }

            //Calculate item total price
            modal_details_rent.bl.total_item_price();

            // Reset extra charges
            modal_details_rent.bl.extra_charges_clear();
        }

        // adding item to selected rent
        this.rent_item_add = async () => {

            //disable button
            document.getElementById('modal_rent_deaails_add_extra_charges').disabled = true;

            ////show loader
            ui.content_loading("modal_rent_details_content_loading");

            var url = '/api/rents_items/add/' + modal_details_rent.rent_id;
            var response = await ajax.get_json(url);

            var item = {};

            item.name = modal_rent_details_item_name.value;
            item.price = modal_rent_details_item_price.value;
            item.quantity = modal_rent_details_item_amount.value;
            item.vat = modal_rent_details_item_tax.value;
            //var total = modal_rent_details_item_total.value;
            item.rent_item_id = response;
            item.rent_item_type = 'earning';
            item.rent_id = modal_details_rent.rent_id;
            item.currency_id = modal_details_rent.currency_id;
            item.exchange = modal_details_rent.exchange;

            var url = '/api/rents_items/save';
            var response = await ajax.post_json(url, item);

            //reload items
            modal_details_rent.bl.rent_items_load();

            //enable button
            document.getElementById('modal_rent_deaails_add_extra_charges').disabled = false;
            //hide loader
            ui.content_loading_hide("modal_rent_details_content_loading");

            //set dault row values to be empty
            modal_details_rent.bl.rent_defulat_row_values();
        }

        this.rent_defulat_row_values = async () => {

            //Set default row values to be empty

            let default_extra_charges = document.getElementById("modal_rent_details_item_name");
            let default_price = document.getElementById("modal_rent_details_item_price");
            let default_amount = document.getElementById("modal_rent_details_item_amount");
            let default_tax = document.getElementById("modal_rent_details_item_tax");
            let default_total = document.getElementById("modal_rent_details_item_total");

            default_extra_charges.value = "";
            default_price.value = "";
            default_amount.value = "";
            default_tax.value = "";
            default_total.value = "";

        }

        this.load_date_add_guest_tab = () => {

            modal_add_guest_details_date_from.value = modal_details_rent.date_from;
            modal_add_guest_details_date_until.value = modal_details_rent.date_until;

        }

        // send confirmation mail to guest
        this.send_confirmation_mail = async () => {

            ui.content_loading('modal_rent_details_content_loading');
            var url = '/api/rents/send_email_confirmation/' + modal_details_rent.rent_id;
            await ajax.get(url);
            modal_details_rent.ui.load_emails();
            ui.content_loading_hide('modal_rent_details_content_loading');
        }

        // send voucher to guest
        this.send_voucher_mail = async () => {

            ui.content_loading('modal_rent_details_content_loading');
            var url = '/api/rents/send_email_voucher/' + modal_details_rent.rent_id;
            await ajax.get(url);
            modal_details_rent.ui.load_emails();
            ui.content_loading_hide('modal_rent_details_content_loading');

        }

        // send offer mail to guest
        this.send_offer_mail = async () => {

            ui.content_loading('modal_rent_details_content_loading');
            var url = '/api/rents/send_email_offer/' + modal_details_rent.rent_id;
            await ajax.get(url);
            modal_details_rent.ui.load_emails();
            ui.content_loading_hide('modal_rent_details_content_loading');

        }

        // Only dropdown
        this.only_dropdown = function (id) {
            var id = document.getElementById(id);
            var btn = id.getElementsByClassName("btn")[0];
            var dropdown = id.lastElementChild;
            btn.addEventListener("click", function () {
                dropdownToggle();
            });
            $(document).mouseup(function (e) {
                if (!$(dropdown).is(e.target) && $(dropdown).has(e.target).length === 0) {
                    dropdown.classList.add("hidden");
                    btn.classList.remove("open");
                }
            });
            function dropdownToggle() {
                if (!btn.classList.contains("open")) {
                    dropdown.classList.remove("hidden");
                    btn.classList.add("open");
                } else {
                    dropdown.classList.add("hidden");
                    btn.classList.remove("open");
                }
            }
            if (id.classList.contains("toggle")) {
                var dropdown_li = id.querySelectorAll(".dropdown_li");
                for (let i = 0; i < dropdown_li.length; i++) {
                    dropdown_li[i].addEventListener("click", function () {
                        dropdown.classList.add("hidden");
                        btn.classList.remove("open");
                    })
                }
            }
        }
    }

    modal_details_rent.load();

</script>